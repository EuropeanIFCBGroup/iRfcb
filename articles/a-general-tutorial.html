<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>iRfcb Introduction • iRfcb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="iRfcb Introduction">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">iRfcb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/a-general-tutorial.html">iRfcb Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/qc-tutorial.html">Quality Control of IFCB Data</a></li>
    <li><a class="dropdown-item" href="../articles/matlab-tutorial.html">Handling MATLAB Results</a></li>
    <li><a class="dropdown-item" href="../articles/dwca-tutorial.html">Creating a DwC-A from IFCB Data</a></li>
    <li><a class="dropdown-item" href="../articles/image-export-tutorial.html">Sharing Annotated IFCB Images</a></li>
    <li><a class="dropdown-item" href="../articles/ecotaxa-tutorial.html">Prepare IFCB Images for EcoTaxa</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EuropeanIFCBGroup/iRfcb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>iRfcb Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EuropeanIFCBGroup/iRfcb/blob/main/vignettes/a-general-tutorial.Rmd" class="external-link"><code>vignettes/a-general-tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>a-general-tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>iRfcb</code> package is an open-source R package designed
to streamline the analysis of Imaging FlowCytobot (IFCB) data, with a
focus on supporting marine ecological research and monitoring. By
integrating R and Python functionalities, the package facilitates
efficient handling of IFCB image data, extraction of key metadata, and
preparation of outputs for further taxonomic, ecological, or spatial
analyses.</p>
<p>This tutorial serves as an introduction to the core functionalities
of <code>iRfcb</code>, providing step-by-step instructions for data
preprocessing, taxonomic analysis, and SHARK-compliant data export.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>You can install the package from CRAN using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"iRfcb"</span><span class="op">)</span></span></code></pre></div>
<p>Load the <code>iRfcb</code> and <code>dplyr</code> libraries:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://europeanifcbgroup.github.io/iRfcb/">iRfcb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># For data wrangling</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-sample-data">Download Sample Data<a class="anchor" aria-label="anchor" href="#download-sample-data"></a>
</h3>
<p>To get started, download sample data from the <a href="https://doi.org/10.17044/scilifelab.25883455.v3" class="external-link">SMHI IFCB
Plankton Image Reference Library</a> (Torstensson et al. 2024) with the
following function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define data directory</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="st">"data"</span></span>
<span></span>
<span><span class="co"># Download and extract test data in the data folder</span></span>
<span><span class="fu"><a href="../reference/ifcb_download_test_data.html">ifcb_download_test_data</a></span><span class="op">(</span>dest_dir <span class="op">=</span> <span class="va">data_dir</span>,</span>
<span>                        max_retries <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        sleep_time <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Download and extraction complete.</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="extract-ifcb-data">Extract IFCB Data<a class="anchor" aria-label="anchor" href="#extract-ifcb-data"></a>
</h2>
<p>This section demonstrates a selection of general data extraction
tools available in <code>iRfcb</code>.</p>
<div class="section level3">
<h3 id="extract-timestamps-from-ifcb-sample-filenames">Extract Timestamps from IFCB sample Filenames<a class="anchor" aria-label="anchor" href="#extract-timestamps-from-ifcb-sample-filenames"></a>
</h3>
<p>Extract timestamps from sample names or filenames:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example sample names</span></span>
<span><span class="va">filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/data/2023/D20230314"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print filenames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filenames</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "D20230314T001205_IFCB134.adc" "D20230314T001205_IFCB134.hdr"</span></span>
<span><span class="co">## [3] "D20230314T001205_IFCB134.roi" "D20230314T003836_IFCB134.adc"</span></span>
<span><span class="co">## [5] "D20230314T003836_IFCB134.hdr" "D20230314T003836_IFCB134.roi"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert filenames to timestamps</span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_convert_filenames.html">ifcb_convert_filenames</a></span><span class="op">(</span><span class="va">filenames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">timestamps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     sample           timestamp       date year month day</span></span>
<span><span class="co">## 1 D20230314T001205_IFCB134 2023-03-14 00:12:05 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 2 D20230314T001205_IFCB134 2023-03-14 00:12:05 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 3 D20230314T001205_IFCB134 2023-03-14 00:12:05 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 4 D20230314T003836_IFCB134 2023-03-14 00:38:36 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 5 D20230314T003836_IFCB134 2023-03-14 00:38:36 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 6 D20230314T003836_IFCB134 2023-03-14 00:38:36 2023-03-14 2023     3  14</span></span>
<span><span class="co">##       time ifcb_number</span></span>
<span><span class="co">## 1 00:12:05     IFCB134</span></span>
<span><span class="co">## 2 00:12:05     IFCB134</span></span>
<span><span class="co">## 3 00:12:05     IFCB134</span></span>
<span><span class="co">## 4 00:38:36     IFCB134</span></span>
<span><span class="co">## 5 00:38:36     IFCB134</span></span>
<span><span class="co">## 6 00:38:36     IFCB134</span></span></code></pre>
<p>If the filename includes ROI numbers (e.g., in an extracted
<code>.png</code> image), a separate column, <code>roi</code>, will be
added to the output.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example sample names</span></span>
<span><span class="va">filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/png/Alexandrium_pseudogonyaulax_050"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print filenames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filenames</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "D20220712T210855_IFCB134_00042.png" "D20220712T210855_IFCB134_00164.png"</span></span>
<span><span class="co">## [3] "D20220712T222710_IFCB134_00044.png"</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert filenames to timestamps</span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_convert_filenames.html">ifcb_convert_filenames</a></span><span class="op">(</span><span class="va">filenames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">timestamps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     sample           timestamp       date year month day</span></span>
<span><span class="co">## 1 D20220712T210855_IFCB134 2022-07-12 21:08:55 2022-07-12 2022     7  12</span></span>
<span><span class="co">## 2 D20220712T210855_IFCB134 2022-07-12 21:08:55 2022-07-12 2022     7  12</span></span>
<span><span class="co">## 3 D20220712T222710_IFCB134 2022-07-12 22:27:10 2022-07-12 2022     7  12</span></span>
<span><span class="co">##       time ifcb_number roi</span></span>
<span><span class="co">## 1 21:08:55     IFCB134  42</span></span>
<span><span class="co">## 2 21:08:55     IFCB134 164</span></span>
<span><span class="co">## 3 22:27:10     IFCB134  44</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="calculate-volume-analyzed-in-ml">Calculate Volume Analyzed in ml<a class="anchor" aria-label="anchor" href="#calculate-volume-analyzed-in-ml"></a>
</h3>
<p>The analyzed volume of a sample can be calculated using data from
<code>.hdr</code> and <code>.adc</code> files.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path to HDR file</span></span>
<span><span class="va">hdr_file</span> <span class="op">&lt;-</span> <span class="st">"data/data/2023/D20230314/D20230314T001205_IFCB134.hdr"</span></span>
<span></span>
<span><span class="co"># Calculate volume analyzed (in ml)</span></span>
<span><span class="va">volume_analyzed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_volume_analyzed.html">ifcb_volume_analyzed</a></span><span class="op">(</span><span class="va">hdr_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">volume_analyzed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4.568676</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="get-sample-runtime">Get Sample Runtime<a class="anchor" aria-label="anchor" href="#get-sample-runtime"></a>
</h3>
<p>Get the runtime from a <code>.hdr</code> file:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get runtime from HDR-file</span></span>
<span><span class="va">run_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_runtime.html">ifcb_get_runtime</a></span><span class="op">(</span><span class="va">hdr_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">run_time</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $runtime</span></span>
<span><span class="co">## [1] 1200.853</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inhibittime</span></span>
<span><span class="co">## [1] 104.3704</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="read-feature-data">Read Feature Data<a class="anchor" aria-label="anchor" href="#read-feature-data"></a>
</h3>
<p>Read all feature files (<code>.csv</code>) from a folder:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read feature files from a folder</span></span>
<span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_features.html">ifcb_read_features</a></span><span class="op">(</span><span class="st">"data/features/2023/"</span>,</span>
<span>                               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># Do not print progress bar</span></span>
<span></span>
<span><span class="co"># Print output of first 10 columns from the first sample in the list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   roi_number Area  Biovolume BoundingBox_xwidth BoundingBox_ywidth ConvexArea</span></span>
<span><span class="co">## 1          2  446   6082.909                 31                 21        542</span></span>
<span><span class="co">## 2          3 4326 142783.030                111                 63       5186</span></span>
<span><span class="co">## 3          4 9739 336908.323                202                129      10581</span></span>
<span><span class="co">## 4          5  580   9186.802                 27                 28        602</span></span>
<span><span class="co">## 5          6 3927 120366.981                 99                 50       4191</span></span>
<span><span class="co">## 6          7  290   3111.748                 22                 20        335</span></span>
<span><span class="co">##   ConvexPerimeter Eccentricity EquivDiameter    Extent</span></span>
<span><span class="co">## 1        87.24196    0.6006111      23.82991 0.6850998</span></span>
<span><span class="co">## 2       291.42030    0.8980639      74.21613 0.6186186</span></span>
<span><span class="co">## 3       505.83898    0.9753657     111.35565 0.3737432</span></span>
<span><span class="co">## 4        88.58696    0.3299815      27.17497 0.7671958</span></span>
<span><span class="co">## 5       265.49548    0.9016151      70.71076 0.7933333</span></span>
<span><span class="co">## 6        67.86613    0.3332706      19.21560 0.6590909</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read only multiblob feature files</span></span>
<span><span class="va">multiblob_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_features.html">ifcb_read_features</a></span><span class="op">(</span><span class="st">"data/features/2023"</span>, </span>
<span>                                         multiblob <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                         verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output of first 10 columns from the first sample in the list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">multiblob_features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   roi_number blob_number Area MajorAxisLength MinorAxisLength Eccentricity</span></span>
<span><span class="co">## 1        154           1 3647       109.93092        45.00010    0.9123779</span></span>
<span><span class="co">## 2        154           2 1626        77.53922        30.74631    0.9180235</span></span>
<span><span class="co">## 3        214           1 7456       232.11148       122.61037    0.8490956</span></span>
<span><span class="co">## 4        214           2 4840       101.68493        68.30606    0.7407850</span></span>
<span><span class="co">## 5        214           3  910        54.18655        28.51088    0.8503847</span></span>
<span><span class="co">## 6        214           4  153        18.95031        10.93057    0.8168844</span></span>
<span><span class="co">##   Orientation ConvexArea EquivDiameter  Solidity</span></span>
<span><span class="co">## 1    11.28171       4205      68.14327 0.8673008</span></span>
<span><span class="co">## 2    26.71876       2495      45.50041 0.6517034</span></span>
<span><span class="co">## 3    30.89332      23666      97.43343 0.3150511</span></span>
<span><span class="co">## 4   -35.88789       6955      78.50146 0.6959022</span></span>
<span><span class="co">## 5    27.00911       1551      34.03892 0.5867182</span></span>
<span><span class="co">## 6    48.78767        188      13.95728 0.8138298</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="extract-images-from-roi-files">Extract Images from ROI files<a class="anchor" aria-label="anchor" href="#extract-images-from-roi-files"></a>
</h2>
<p>IFCB images stored in <code>.roi</code> files can be extracted as
<code>.png</code> files using the <code>iRfcb</code> package, as
demonstrated below.</p>
<p>Extract all images from a sample using the <a href="../reference/ifcb_extract_pngs.html"><code>ifcb_extract_pngs</code></a>
function. You can specify the <code>out_folder</code>, but by default,
images will be saved in a subdirectory within the same directory as the
ROI file. The <code>gamma</code> can be adjusted to enhance image
contrast.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All ROIs in sample</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_pngs.html">ifcb_extract_pngs</a></span><span class="op">(</span><span class="st">"data/data/2023/D20230314/D20230314T001205_IFCB134.roi"</span>,</span>
<span>                  gamma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># Default gamma value</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 1218 ROIs from D20230314T001205_IFCB134.roi to data/data/2023/D20230314/D20230314T001205_IFCB134</span></span></code></pre>
<p>Extract specific ROIs:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only ROI number 2 and 5</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_pngs.html">ifcb_extract_pngs</a></span><span class="op">(</span><span class="st">"data/data/2023/D20230314/D20230314T003836_IFCB134.roi"</span>,</span>
<span>                  ROInumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 2 ROIs from D20230314T003836_IFCB134.roi to data/data/2023/D20230314/D20230314T003836_IFCB134</span></span></code></pre>
<p>To extract annotated images or classified results from MATLAB files,
please see the <a href="../articles/image-export-tutorial.html">Sharing
Annotated IFCB Images</a> and <a href="../articles/matlab-tutorial.html">Handling MATLAB Results</a>
tutorials.</p>
</div>
<div class="section level2">
<h2 id="taxonomical-data">Taxonomical Data<a class="anchor" aria-label="anchor" href="#taxonomical-data"></a>
</h2>
<p>Maintaining up-to-date taxonomic data is essential for ensuring
accurate species names and classifications, which directly impact
calculations like carbon concentrations in <code>iRfcb</code>.</p>
<p>Up-to-date taxonomy also ensures data harmonization by preventing
issues like misspellings, outdated synonyms, or inconsistent
classifications. This consistency is crucial for integrating and
comparing datasets across studies, regions, and time periods, improving
the reliability of scientific outcomes.</p>
<div class="section level3">
<h3 id="taxon-matching-with-worms">Taxon matching with WoRMS<a class="anchor" aria-label="anchor" href="#taxon-matching-with-worms"></a>
</h3>
<p>Taxonomic names can be matched against the <a href="https://www.marinespecies.org/" class="external-link">World Register of Marine Species
(WoRMS)</a>, ensuring accuracy and consistency. The <code>iRfcb</code>
package includes a built-in function for taxon matching via the WoRMS
API, featuring a retry mechanism to handle server errors, making it
particularly useful for automated data pipelines. For additional tools
and functionality, the R package <a href="https://cran.r-project.org/package=worrms" class="external-link"><code>worrms</code></a>
provides a comprehensive suite of options for interacting with the WoRMS
database.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example taxa names</span></span>
<span><span class="va">taxa_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alexandrium_pseudogonyaulax"</span>, <span class="st">"Guinardia_delicatula"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve WoRMS records</span></span>
<span><span class="va">worms_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_match_taxa_names.html">ifcb_match_taxa_names</a></span><span class="op">(</span><span class="va">taxa_names</span>, </span>
<span>                                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># Do not print progress bar</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">worms_records</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 28</span></span></span>
<span><span class="co">##   name  AphiaID url   scientificname authority status unacceptreason taxonRankID</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Alex…  <span style="text-decoration: underline;">109</span>713 http… Alexandrium p… (Biechel… accep… <span style="color: #BB0000;">NA</span>                     220</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Guin…  <span style="text-decoration: underline;">149</span>112 http… Guinardia del… (Cleve) … unass… <span style="color: #BB0000;">NA</span>                     220</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 20 more variables: rank &lt;chr&gt;, valid_AphiaID &lt;int&gt;, valid_name &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   valid_authority &lt;chr&gt;, parentNameUsageID &lt;int&gt;, kingdom &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   phylum &lt;chr&gt;, class &lt;chr&gt;, order &lt;chr&gt;, family &lt;chr&gt;, genus &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   citation &lt;chr&gt;, lsid &lt;chr&gt;, isMarine &lt;int&gt;, isBrackish &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   isFreshwater &lt;int&gt;, isTerrestrial &lt;int&gt;, isExtinct &lt;int&gt;, match_type &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   modified &lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="check-whether-a-class-name-is-a-diatom">Check whether a class name is a diatom<a class="anchor" aria-label="anchor" href="#check-whether-a-class-name-is-a-diatom"></a>
</h3>
<p>This function takes a list of taxa names, cleans them, retrieves
their corresponding classification records from WoRMS, and checks if
they belong to the specified diatom class. The function only uses the
first name (genus name) of each taxa for classification. This function
can be useful for converting biovolumes to carbon according to
Menden-Deuer and Lessard (2000). See <a href="../reference/vol2C_nondiatom.html"><code>vol2C_nondiatom</code></a>
and <a href="../reference/vol2C_lgdiatom.html"><code>vol2C_lgdiatom</code></a>
for carbon calculations (not included in NAMESPACE).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read class2use file and select five taxa</span></span>
<span><span class="va">class2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_variable.html">ifcb_get_mat_variable</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span><span class="op">)</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create a dataframe with class name and result from `ifcb_is_diatom`</span></span>
<span><span class="va">class_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">class2use</span>,</span>
<span>                         is_diatom <span class="op">=</span> <span class="fu"><a href="../reference/ifcb_is_diatom.html">ifcb_is_diatom</a></span><span class="op">(</span><span class="va">class2use</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print rows 10-15 of result</span></span>
<span><span class="va">class_list</span></span></code></pre></div>
<pre><code><span><span class="co">##                    class2use is_diatom</span></span>
<span><span class="co">## 1        Nodularia_spumigena     FALSE</span></span>
<span><span class="co">## 2            Cryptomonadales     FALSE</span></span>
<span><span class="co">## 3    Acanthoica_quattrospina     FALSE</span></span>
<span><span class="co">## 4 Asterionellopsis_glacialis      TRUE</span></span>
<span><span class="co">## 5                  Centrales      TRUE</span></span>
<span><span class="co">## 6            Centrales_chain      TRUE</span></span></code></pre>
<p>The default class for diatoms is defined as Bacillariophyceae, but
may be adjusted using the <code>diatom_class</code> argument.</p>
</div>
<div class="section level3">
<h3 id="find-trophic-type-of-plankton-taxa">Find trophic type of plankton taxa<a class="anchor" aria-label="anchor" href="#find-trophic-type-of-plankton-taxa"></a>
</h3>
<p>This function takes a list of taxa names and matches them with the
<strong>SMHI Trophic Type</strong> list used in <a href="https://shark.smhi.se/hamta-data/" class="external-link">SHARK</a>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example taxa names</span></span>
<span><span class="va">taxa_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Acanthoceras zachariasii"</span>,</span>
<span>               <span class="st">"Nodularia spumigena"</span>,</span>
<span>               <span class="st">"Acanthoica quattrospina"</span>,</span>
<span>               <span class="st">"Noctiluca"</span>,</span>
<span>               <span class="st">"Gymnodiniales"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get trophic type for taxa</span></span>
<span><span class="va">trophic_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_trophic_type.html">ifcb_get_trophic_type</a></span><span class="op">(</span><span class="va">taxa_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trophic_type</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "AU" "AU" "MX" "HT" "NS"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="shark-export">SHARK export<a class="anchor" aria-label="anchor" href="#shark-export"></a>
</h2>
<p>This function is used by SMHI to map IFCB data into the <a href="https://shark.smhi.se/hamta-data/" class="external-link">SHARK</a> standard data
delivery format. An example submission is also provided in
<code>iRfcb</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get column names from example</span></span>
<span><span class="va">shark_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_shark_colnames.html">ifcb_get_shark_colnames</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print column names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">shark_colnames</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] MYEAR                  STATN                  SAMPLING_PLATFORM     </span></span>
<span><span class="co">##  [4] PROJ                   ORDERER                SHIPC                 </span></span>
<span><span class="co">##  [7] CRUISE_NO              DATE_TIME              SDATE                 </span></span>
<span><span class="co">## [10] STIME                  TIMEZONE               LATIT                 </span></span>
<span><span class="co">## [13] LONGI                  POSYS                  WADEP                 </span></span>
<span><span class="co">## [16] MPROG                  MNDEP                  MXDEP                 </span></span>
<span><span class="co">## [19] SLABO                  ACKR_SMP               SMTYP                 </span></span>
<span><span class="co">## [22] PDMET                  SMVOL                  METFP                 </span></span>
<span><span class="co">## [25] IFCBNO                 SMPNO                  LATNM                 </span></span>
<span><span class="co">## [28] SFLAG                  LATNM_SFLAG            TRPHY                 </span></span>
<span><span class="co">## [31] APHIA_ID               IMAGE_VERIFICATION     VERIFIED_BY           </span></span>
<span><span class="co">## [34] COUNT                  ABUND                  BIOVOL                </span></span>
<span><span class="co">## [37] C_CONC                 QFLAG                  COEFF                 </span></span>
<span><span class="co">## [40] CLASS_NAME             CLASS_F1               UNCLASSIFIED_COUNTS   </span></span>
<span><span class="co">## [43] UNCLASSIFIED_ABUNDANCE UNCLASSIFIED_VOLUME    METOA                 </span></span>
<span><span class="co">## [46] ASSOCIATED_MEDIA       CLASSPROG              ALABO                 </span></span>
<span><span class="co">## [49] ACKR_ANA               ANADATE                METDC                 </span></span>
<span><span class="co">## [52] TRAINING_SET           CLASSIFIER_USED        MANUAL_QC_DATE        </span></span>
<span><span class="co">## [55] PRE_FILTER_SIZE        PH_FB                  CHL_FB                </span></span>
<span><span class="co">## [58] CDOM_FB                PHYC_FB                PHER_FB               </span></span>
<span><span class="co">## [61] WATERFLOW_FB           TURB_FB                PCO2_FB               </span></span>
<span><span class="co">## [64] TEMP_FB                PSAL_FB                OSAT_FB               </span></span>
<span><span class="co">## [67] DOXY_FB               </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load example stored from `iRfcb`</span></span>
<span><span class="va">shark_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_shark_example.html">ifcb_get_shark_example</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print first ten columns of the SHARK data submission example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">shark_example</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   MYEAR                  STATN SAMPLING_PLATFORM              PROJ ORDERER</span></span>
<span><span class="co">## 1  2022 RV_FB_D20220713T175838              IFCB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">## 2  2022 RV_FB_D20220713T175838              IFCB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">## 3  2022 RV_FB_D20220713T175838              IFCB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">## 4  2022 RV_FB_D20220713T175838              IFCB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">## 5  2022 RV_FB_D20220713T175838            SveaFB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">##   SHIPC CRUISE_NO DATE_TIME      SDATE    STIME</span></span>
<span><span class="co">## 1  77SE        12  2,02E+13 2022-07-13 17:58:38</span></span>
<span><span class="co">## 2  77SE        12  2,02E+13 2022-07-13 17:58:38</span></span>
<span><span class="co">## 3  77SE        12  2,02E+13 2022-07-13 17:58:38</span></span>
<span><span class="co">## 4  77SE        12  2,02E+13 2022-07-13 17:58:38</span></span>
<span><span class="co">## 5  77SE        12  2,02E+13 2022-07-13 17:58:38</span></span></code></pre>
<p>This concludes this tutorial for the <code>iRfcb</code> package. For
more detailed information, refer to the package documentation or the
other <a href="../articles/index.html">tutorials</a>. See how data
pipelines can be constructed using <code>iRfcb</code> in the following
<a href="https://github.com/nodc-sweden/ifcb-data-pipeline" class="external-link">Example
Project</a>. Happy analyzing!</p>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<pre><code><span><span class="co">## To cite package 'iRfcb' in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Anders Torstensson (2025). iRfcb: Tools for Managing Imaging</span></span>
<span><span class="co">##   FlowCytobot (IFCB) Data. R package version 0.4.3.</span></span>
<span><span class="co">##   https://doi.org/10.5281/zenodo.12533225</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Manual{,</span></span>
<span><span class="co">##     title = {iRfcb: Tools for Managing Imaging FlowCytobot (IFCB) Data},</span></span>
<span><span class="co">##     author = {Anders Torstensson},</span></span>
<span><span class="co">##     year = {2025},</span></span>
<span><span class="co">##     note = {R package version 0.4.3},</span></span>
<span><span class="co">##     url = {https://doi.org/10.5281/zenodo.12533225},</span></span>
<span><span class="co">##   }</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Torstensson, A., Skjevik, A-T., Mohlin, M., Karlberg, M. and
Karlson, B. (2024). SMHI IFCB Plankton Image Reference Library.
SciLifeLab. Dataset. <a href="https://doi.org/10.17044/scilifelab.25883455.v3" class="external-link uri">https://doi.org/10.17044/scilifelab.25883455.v3</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anders Torstensson, DTO-BioFlow.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>iRfcb Tutorial • iRfcb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="iRfcb Tutorial">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">iRfcb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.13</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/tutorial.html">Tutorial</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>iRfcb Tutorial</h1>
            
      

      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level4">
<h4 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p>You can install the package from GitHub using the
<code>devtools</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"EuropeanIFCBGroup/iRfcb"</span>,</span>
<span>                         dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Some functions in <code>iRfcb</code> require <code>Python</code> to
be installed (see in the sections below). You can download
<code>Python</code> from the official website: <a href="https://www.python.org/downloads/" class="external-link">python.org/downloads</a>.</p>
<p>Load the <code>iRfcb</code> library:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://europeanifcbgroup.github.io/iRfcb/">iRfcb</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="download-sample-data">Download Sample Data<a class="anchor" aria-label="anchor" href="#download-sample-data"></a>
</h4>
<p>To get started, download sample data from the <a href="https://doi.org/10.17044/scilifelab.25883455.v3" class="external-link">SMHI IFCB
Plankton Image Reference Library</a> (Torstensson et al. 2024) with the
following function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define data directory</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="st">"data"</span></span>
<span></span>
<span><span class="co"># Download and extract test data in the data folder</span></span>
<span><span class="fu"><a href="../reference/ifcb_download_test_data.html">ifcb_download_test_data</a></span><span class="op">(</span>dest_dir <span class="op">=</span> <span class="va">data_dir</span>,</span>
<span>                        max_retries <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        sleep_time <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Download and extraction complete.</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="extract-timestamps-and-sample-volumes">Extract Timestamps and Sample Volumes<a class="anchor" aria-label="anchor" href="#extract-timestamps-and-sample-volumes"></a>
</h2>
<div class="section level4">
<h4 id="extract-timestamps-from-ifcb-sample-filenames">Extract Timestamps from IFCB sample Filenames<a class="anchor" aria-label="anchor" href="#extract-timestamps-from-ifcb-sample-filenames"></a>
</h4>
<p>Extract timestamps from sample names or filenames:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example sample names</span></span>
<span><span class="va">filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D20230314T001205_IFCB134"</span>,</span>
<span>               <span class="st">"D20230615T123045_IFCB135.roi"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert filenames to timestamps</span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_convert_filenames.html">ifcb_convert_filenames</a></span><span class="op">(</span><span class="va">filenames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">timestamps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     sample           timestamp       date year month day</span></span>
<span><span class="co">## 1 D20230314T001205_IFCB134 2023-03-14 00:12:05 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 2 D20230615T123045_IFCB135 2023-06-15 12:30:45 2023-06-15 2023     6  15</span></span>
<span><span class="co">##       time ifcb_number</span></span>
<span><span class="co">## 1 00:12:05     IFCB134</span></span>
<span><span class="co">## 2 12:30:45     IFCB135</span></span></code></pre>
<p>With ROI numbers:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example sample names</span></span>
<span><span class="va">filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D20230314T001205_IFCB134_00023.png"</span>,</span>
<span>               <span class="st">"D20230615T123045_IFCB135"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert filenames to timestamps</span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_convert_filenames.html">ifcb_convert_filenames</a></span><span class="op">(</span><span class="va">filenames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">timestamps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     sample           timestamp       date year month day</span></span>
<span><span class="co">## 1 D20230314T001205_IFCB134 2023-03-14 00:12:05 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 2 D20230615T123045_IFCB135 2023-06-15 12:30:45 2023-06-15 2023     6  15</span></span>
<span><span class="co">##       time ifcb_number roi</span></span>
<span><span class="co">## 1 00:12:05     IFCB134  23</span></span>
<span><span class="co">## 2 12:30:45     IFCB135  NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="get-volume-analyzed-in-ml">Get Volume Analyzed in ml<a class="anchor" aria-label="anchor" href="#get-volume-analyzed-in-ml"></a>
</h4>
<p>Get the volume analyzed from header/adc files:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path to HDR file</span></span>
<span><span class="va">hdr_file</span> <span class="op">&lt;-</span> <span class="st">"data/data/2023/D20230314/D20230314T001205_IFCB134.hdr"</span></span>
<span></span>
<span><span class="co"># Calculate volume analyzed (in ml)</span></span>
<span><span class="va">volume_analyzed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_volume_analyzed.html">ifcb_volume_analyzed</a></span><span class="op">(</span><span class="va">hdr_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">volume_analyzed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4.568676</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="get-sample-runtime">Get Sample Runtime<a class="anchor" aria-label="anchor" href="#get-sample-runtime"></a>
</h4>
<p>Get the runtime from a header file:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get runtime from HDR-file</span></span>
<span><span class="va">run_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_runtime.html">ifcb_get_runtime</a></span><span class="op">(</span><span class="va">hdr_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">run_time</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $runtime</span></span>
<span><span class="co">## [1] 1200.853</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inhibittime</span></span>
<span><span class="co">## [1] 104.3704</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="extract--png-images-from-roi">Extract .PNG Images from ROI<a class="anchor" aria-label="anchor" href="#extract--png-images-from-roi"></a>
</h2>
<p>Extract all images from a sample:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All ROIs in sample</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_pngs.html">ifcb_extract_pngs</a></span><span class="op">(</span><span class="st">"data/data/2023/D20230314/D20230314T001205_IFCB134.roi"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 1276 ROIs from D20230314T001205_IFCB134.roi to data/data/2023/D20230314/D20230314T001205_IFCB134</span></span></code></pre>
<p>Extract specific ROIs:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only ROI number 2 and 5</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_pngs.html">ifcb_extract_pngs</a></span><span class="op">(</span><span class="st">"data/data/2023/D20230314/D20230314T003836_IFCB134.roi"</span>,</span>
<span>                  ROInumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 2 ROIs from D20230314T003836_IFCB134.roi to data/data/2023/D20230314/D20230314T003836_IFCB134</span></span></code></pre>
<p>To extract annotated images from MATLAB files, please see <a href="#use-matlab-annotated-files">Use MATLAB Annotated Files</a> To
extract classified results from MATLAB files, please see <a href="#classified-results-from-matlab">Classified Results from
MATLAB</a></p>
</div>
<div class="section level2">
<h2 id="psd-qcqa">PSD QC/QA<a class="anchor" aria-label="anchor" href="#psd-qcqa"></a>
</h2>
<div class="section level4">
<h4 id="particle-size-distribution">Particle Size Distribution<a class="anchor" aria-label="anchor" href="#particle-size-distribution"></a>
</h4>
<p>IFCB data can be quality controlled by analyzing the particle size
distribution (PSD) (Hayashi et al. in prep). <code>iRfcb</code> uses the
code available at <a href="https://github.com/kudelalab/PSD" class="external-link">https://github.com/kudelalab/PSD</a>.
Before running the PSD quality check, ensure the necessary Python
environment is set up and activated:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define path to virtual environment</span></span>
<span><span class="va">env_path</span> <span class="op">&lt;-</span> <span class="st">"~/.virtualenvs/iRfcb"</span> <span class="co"># Or your preferred venv path</span></span>
<span></span>
<span><span class="co"># Install python virtual environment</span></span>
<span><span class="fu"><a href="../reference/ifcb_py_install.html">ifcb_py_install</a></span><span class="op">(</span>envname <span class="op">=</span> <span class="va">env_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run PSD quality control</span></span>
<span><span class="va">psd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_psd.html">ifcb_psd</a></span><span class="op">(</span>feature_folder <span class="op">=</span> <span class="st">"data/features/2023"</span>,</span>
<span>                hdr_folder <span class="op">=</span> <span class="st">"data/data/2023"</span>,</span>
<span>                save_data <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                output_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                plot_folder <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                use_marker <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                start_fit <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                r_sqr <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                beads <span class="op">=</span> <span class="fl">10</span> <span class="op">**</span> <span class="fl">12</span>,</span>
<span>                bubbles <span class="op">=</span> <span class="fl">150</span>,</span>
<span>                incomplete <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1500</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                missing_cells <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>                biomass <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                bloom <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                humidity <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print output from PSD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">psd</span><span class="op">$</span><span class="va">fits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">##   sample            a     k   R.2 max_ESD_diff capture_percent bead_run humidity</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D20230314T… 5.90<span style="color: #949494;">e</span> 5 -<span style="color: #BB0000;">1.88</span> 0.713            3           0.955 FALSE        16.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D20230314T… 2.51<span style="color: #949494;">e</span> 5 -<span style="color: #BB0000;">1.60</span> 0.702            3           0.944 FALSE        16.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D20230810T… 3.36<span style="color: #949494;">e</span> 7 -<span style="color: #BB0000;">2.73</span> 0.955            4           0.919 FALSE        65.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D20230915T… 1.32<span style="color: #949494;">e</span>10 -<span style="color: #BB0000;">5.54</span> 0.989            2           0.967 FALSE        71.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D20230915T… 4.39<span style="color: #949494;">e</span>10 -<span style="color: #BB0000;">6.03</span> 0.981            3           0.961 FALSE        71.5</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">psd</span><span class="op">$</span><span class="va">flags</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">##   sample           flag         </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D20230915T091133 High Humidity</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D20230915T093804 High Humidity</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot PSD of the first sample</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_psd_plot.html">ifcb_psd_plot</a></span><span class="op">(</span>sample_name <span class="op">=</span> <span class="va">psd</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">sample</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                      data <span class="op">=</span> <span class="va">psd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>                      fits <span class="op">=</span> <span class="va">psd</span><span class="op">$</span><span class="va">fits</span>,</span>
<span>                      start_fit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="geographical-qcqa">Geographical QC/QA<a class="anchor" aria-label="anchor" href="#geographical-qcqa"></a>
</h2>
<div class="section level4">
<h4 id="check-if-ifcb-is-near-land">Check if IFCB is Near Land<a class="anchor" aria-label="anchor" href="#check-if-ifcb-is-near-land"></a>
</h4>
<p>To determine if the IFCB is near land (i.e. in harbor), examine the
position data in the .hdr files (or from vectors of latitudes and
longitudes):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read HDR data and extract GPS position (when available)</span></span>
<span><span class="va">gps_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_hdr_data.html">ifcb_read_hdr_data</a></span><span class="op">(</span><span class="st">"data/data/"</span>,</span>
<span>                               gps_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Found 9 .hdr files.</span></span>
<span><span class="co">## Processing completed.</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create new column with the results</span></span>
<span><span class="va">gps_data</span><span class="op">$</span><span class="va">near_land</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_is_near_land.html">ifcb_is_near_land</a></span><span class="op">(</span><span class="va">gps_data</span><span class="op">$</span><span class="va">gpsLatitude</span>,</span>
<span>                                        <span class="va">gps_data</span><span class="op">$</span><span class="va">gpsLongitude</span>,</span>
<span>                                        distance <span class="op">=</span> <span class="fl">100</span>, <span class="co"># 100 meters from shore</span></span>
<span>                                        shape <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co"># Using the default NE 1:50m Land Polygon</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gps_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     sample gpsLatitude gpsLongitude           timestamp</span></span>
<span><span class="co">## 1 D20220522T000439_IFCB134          NA           NA 2022-05-22 00:04:39</span></span>
<span><span class="co">## 2 D20220522T003051_IFCB134          NA           NA 2022-05-22 00:30:51</span></span>
<span><span class="co">## 3 D20220712T210855_IFCB134          NA           NA 2022-07-12 21:08:55</span></span>
<span><span class="co">## 4 D20220712T222710_IFCB134          NA           NA 2022-07-12 22:27:10</span></span>
<span><span class="co">## 5 D20230314T001205_IFCB134    56.66883     12.11303 2023-03-14 00:12:05</span></span>
<span><span class="co">## 6 D20230314T003836_IFCB134    56.66884     12.11302 2023-03-14 00:38:36</span></span>
<span><span class="co">##         date year month day     time ifcb_number near_land</span></span>
<span><span class="co">## 1 2022-05-22 2022     5  22 00:04:39     IFCB134        NA</span></span>
<span><span class="co">## 2 2022-05-22 2022     5  22 00:30:51     IFCB134        NA</span></span>
<span><span class="co">## 3 2022-07-12 2022     7  12 21:08:55     IFCB134        NA</span></span>
<span><span class="co">## 4 2022-07-12 2022     7  12 22:27:10     IFCB134        NA</span></span>
<span><span class="co">## 5 2023-03-14 2023     3  14 00:12:05     IFCB134     FALSE</span></span>
<span><span class="co">## 6 2023-03-14 2023     3  14 00:38:36     IFCB134     FALSE</span></span></code></pre>
<p>For more accurate determination, a detailed coastline .shp file may
be required (e.g. the <a href="https://www.eea.europa.eu/data-and-maps/data/eea-coastline-for-analysis-2/gis-data/eea-coastline-polygon" class="external-link">EEA
Coastline Polygon</a>). Refer to the help pages of <a href="../reference/ifcb_is_near_land.html"><code>ifcb_is_near_land</code></a>
for further information.</p>
</div>
<div class="section level4">
<h4 id="check-which-sub-basin-an-ifcb-sample-is-from">Check which sub-basin an IFCB sample is from<a class="anchor" aria-label="anchor" href="#check-which-sub-basin-an-ifcb-sample-is-from"></a>
</h4>
<p>To identify the specific sub-basin of the Baltic Sea (or using a
custom shape-file) from which an Imaging FlowCytobot (IFCB) sample was
collected, analyze the position data:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define example latitude and longitude vectors</span></span>
<span><span class="va">latitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55.337</span>, <span class="fl">54.729</span>, <span class="fl">56.311</span>, <span class="fl">57.975</span><span class="op">)</span></span>
<span><span class="va">longitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.674</span>, <span class="fl">14.643</span>, <span class="fl">12.237</span>, <span class="fl">10.637</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check in which Baltic sea basin the points are in</span></span>
<span><span class="va">points_in_the_baltic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_which_basin.html">ifcb_which_basin</a></span><span class="op">(</span><span class="va">latitudes</span>, </span>
<span>                                         <span class="va">longitudes</span>, </span>
<span>                                         shape_file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">points_in_the_baltic</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "13 - Arkona Basin"   "12 - Bornholm Basin" "16 - Kattegat"      </span></span>
<span><span class="co">## [4] "17 - Skagerrak"</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the points and the basins</span></span>
<span><span class="fu"><a href="../reference/ifcb_which_basin.html">ifcb_which_basin</a></span><span class="op">(</span><span class="va">latitudes</span>, </span>
<span>                 <span class="va">longitudes</span>, </span>
<span>                 plot <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 shape_file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>This function reads a pre-packaged shapefile of the Baltic Sea,
Kattegat, and Skagerrak basins from the ‘iRfcb’ package by default, or a
user-supplied shapefile if provided. The shapefiles provided in ‘iRfcb’
originate from <a href="https://sharkweb.smhi.se/hamta-data/" class="external-link">SHARK</a>.</p>
</div>
<div class="section level4">
<h4 id="check-whether-the-positions-are-within-the-baltic-sea-or-elsewhere">Check whether the positions are within the Baltic Sea or
elsewhere<a class="anchor" aria-label="anchor" href="#check-whether-the-positions-are-within-the-baltic-sea-or-elsewhere"></a>
</h4>
<p>This check is useful if only you want to apply a classifier
specifically to phytoplankton from the Baltic Sea.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define example latitude and longitude vectors</span></span>
<span><span class="va">latitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55.337</span>, <span class="fl">54.729</span>, <span class="fl">56.311</span>, <span class="fl">57.975</span><span class="op">)</span></span>
<span><span class="va">longitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.674</span>, <span class="fl">14.643</span>, <span class="fl">12.237</span>, <span class="fl">10.637</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check if the points are in the Baltic Sea Basin</span></span>
<span><span class="va">points_in_the_baltic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_is_in_basin.html">ifcb_is_in_basin</a></span><span class="op">(</span><span class="va">latitudes</span>, <span class="va">longitudes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">points_in_the_baltic</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  TRUE  TRUE FALSE FALSE</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the points and the basin</span></span>
<span><span class="fu"><a href="../reference/ifcb_is_in_basin.html">ifcb_is_in_basin</a></span><span class="op">(</span><span class="va">latitudes</span>, <span class="va">longitudes</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>This function reads a land-buffered shapefile of the Baltic Sea Basin
from the ‘iRfcb’ package by default, or a user-supplied shapefile if
provided.</p>
</div>
<div class="section level4">
<h4 id="find-missing-positions-from-rv-svea-ferrybox">Find missing positions from RV Svea Ferrybox<a class="anchor" aria-label="anchor" href="#find-missing-positions-from-rv-svea-ferrybox"></a>
</h4>
<p>This function is used by SMHI to collect and match stored ferrybox
positions when they are not available in the .hdr files. An example
ferrybox data file is provided in <code>iRfcb</code> with data matching
D20220522T000439_IFCB134.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define path where ferrybox data are located</span></span>
<span><span class="va">ferrybox_folder</span> <span class="op">&lt;-</span> <span class="st">"data/ferrybox_data"</span></span>
<span></span>
<span><span class="co"># Get GPS position from ferrybox data</span></span>
<span><span class="va">positions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_ferrybox_data.html">ifcb_get_ferrybox_data</a></span><span class="op">(</span><span class="va">gps_data</span><span class="op">$</span><span class="va">timestamp</span>, </span>
<span>                                    <span class="va">ferrybox_folder</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">positions</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             timestamp gpsLatitude gpsLongitude</span></span>
<span><span class="co">## 1 2022-05-22 00:04:39     55.0277      13.6142</span></span>
<span><span class="co">## 2 2022-05-22 00:30:51          NA           NA</span></span>
<span><span class="co">## 3 2022-07-12 21:08:55          NA           NA</span></span>
<span><span class="co">## 4 2022-07-12 22:27:10          NA           NA</span></span>
<span><span class="co">## 5 2023-03-14 00:12:05          NA           NA</span></span>
<span><span class="co">## 6 2023-03-14 00:38:36          NA           NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="find-contextual-ferrybox-data-from-rv-svea">Find contextual ferrybox data from RV Svea<a class="anchor" aria-label="anchor" href="#find-contextual-ferrybox-data-from-rv-svea"></a>
</h4>
<p>The <a href="../reference/ifcb_get_ferrybox_data.html"><code>ifcb_get_ferrybox_data</code></a>
function can also be used to extract additional ferrybox parameters,
such as temperature (parameter number 8180) and salinity (parameter
number 8181).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get salinity and temperature from ferrybox data</span></span>
<span><span class="va">ferrybox_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_ferrybox_data.html">ifcb_get_ferrybox_data</a></span><span class="op">(</span><span class="va">gps_data</span><span class="op">$</span><span class="va">timestamp</span>, </span>
<span>                                        <span class="va">ferrybox_folder</span>, </span>
<span>                                        parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"8180"</span>, <span class="st">"8181"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ferrybox_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             timestamp    8180  8181</span></span>
<span><span class="co">## 1 2022-05-22 00:04:39 11.3897 7.864</span></span>
<span><span class="co">## 2 2022-05-22 00:30:51      NA    NA</span></span>
<span><span class="co">## 3 2022-07-12 21:08:55      NA    NA</span></span>
<span><span class="co">## 4 2022-07-12 22:27:10      NA    NA</span></span>
<span><span class="co">## 5 2023-03-14 00:12:05      NA    NA</span></span>
<span><span class="co">## 6 2023-03-14 00:38:36      NA    NA</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="use-matlab-annotated-files">Use MATLAB Annotated Files<a class="anchor" aria-label="anchor" href="#use-matlab-annotated-files"></a>
</h2>
<div class="section level4">
<h4 id="count-and-summarize-annotated-image-data">Count and Summarize Annotated Image Data<a class="anchor" aria-label="anchor" href="#count-and-summarize-annotated-image-data"></a>
</h4>
</div>
<div class="section level4">
<h4 id="png-directory">PNG Directory<a class="anchor" aria-label="anchor" href="#png-directory"></a>
</h4>
<p>Summarize counts of annotated images at the sample and class levels.
The ‘hdr_folder’ can be included to add GPS positions to the sample data
frame:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarise counts on sample level</span></span>
<span><span class="va">png_per_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_counts.html">ifcb_summarize_png_counts</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/png"</span>,</span>
<span>                                          hdr_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                                          sum_level <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">png_per_sample</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   sample, ifcb_number [3]</span></span></span>
<span><span class="co">##   sample    ifcb_number class_name n_images roi_numbers gpsLatitude gpsLongitude</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D2022052… IFCB134     Ciliophora        1 5                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D2022052… IFCB134     Mesodiniu…        4 2, 6, 7, 8           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D2022052… IFCB134     Strombidi…        1 3                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D2022052… IFCB134     Mesodiniu…        2 2, 3                 <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D2022071… IFCB134     Alexandri…        2 42, 164              <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> D2022071… IFCB134     Strombidi…        2 34, 79               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 6 more variables: timestamp &lt;dttm&gt;, date &lt;date&gt;, year &lt;dbl&gt;, month &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   day &lt;int&gt;, time &lt;chr&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarise counts on class level</span></span>
<span><span class="va">png_per_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_counts.html">ifcb_summarize_png_counts</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/png"</span>,</span>
<span>                                         sum_level <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">png_per_class</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   class_name                  n_images</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Alexandrium_pseudogonyaulax        3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Amphidnium-like                    1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Chaetoceros_spp_chain              6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Chaetoceros_spp_single_cell        3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Ciliophora                        23</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Cryptomonadales                  245</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="matlab-files">MATLAB Files<a class="anchor" aria-label="anchor" href="#matlab-files"></a>
</h4>
<p>Count the annotations in the MATLAB files, similar to <a href="../reference/ifcb_summarize_png_counts.html"><code>ifcb_summarize_png_counts</code></a>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize counts from MATLAB files</span></span>
<span><span class="va">mat_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_count_mat_annotations.html">ifcb_count_mat_annotations</a></span><span class="op">(</span>manual_files <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                                        class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>                                        skip_class <span class="op">=</span> <span class="st">"unclassified"</span>, <span class="co"># Or class ID</span></span>
<span>                                        sum_level <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># Or per "sample"</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mat_count</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   class                           n</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Alexandrium_pseudogonyaulax     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Amphidnium-like                 1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Chaetoceros_spp_chain           6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Chaetoceros_spp_single_cell     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Ciliophora                     23</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Cryptomonadales               245</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="run-image-gallery">Run Image Gallery<a class="anchor" aria-label="anchor" href="#run-image-gallery"></a>
</h4>
<p>To visually inspect and correct annotations, run the image
gallery.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run Shiny app</span></span>
<span><span class="fu"><a href="../reference/ifcb_run_image_gallery.html">ifcb_run_image_gallery</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fimage_gallery.png" alt="image_gallery"><div class="figcaption">image_gallery</div>
</div>
<p>Individual images can be selected and a list of selected images can
be downloaded as a ‘correction_file’. This file can be used to correct
.mat annotations below using the <a href="../reference/ifcb_correct_annotation.html"><code>ifcb_correct_annotation</code></a>
function.</p>
</div>
<div class="section level4">
<h4 id="correct--mat-files-after-checking-images-in-the-app">Correct .mat Files After Checking Images in the App<a class="anchor" aria-label="anchor" href="#correct--mat-files-after-checking-images-in-the-app"></a>
</h4>
<p>After reviewing images in the gallery, correct the .mat files using
the ‘correction file’ with selected images:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get class2use</span></span>
<span><span class="va">class_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_names.html">ifcb_get_mat_names</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span><span class="op">)</span></span>
<span><span class="va">class2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_variable.html">ifcb_get_mat_variable</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span>,</span>
<span>                                   variable_name <span class="op">=</span> <span class="va">class_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the class id of unclassified</span></span>
<span><span class="va">unclassified_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"unclassified"</span>,</span>
<span>                         <span class="va">class2use</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the python session if not already set up</span></span>
<span><span class="co"># env_path &lt;- "~/.virtualenvs/iRfcb"</span></span>
<span><span class="co"># ifcb_py_install(envname = env_path)</span></span>
<span></span>
<span><span class="co"># Correct the annotation with the output from the image gallery</span></span>
<span><span class="fu"><a href="../reference/ifcb_correct_annotation.html">ifcb_correct_annotation</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                        out_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                        correction <span class="op">=</span> <span class="st">"data/manual/correction/Alexandrium_pseudogonyaulax_selected_images.txt"</span>,</span>
<span>                        correct_classid <span class="op">=</span> <span class="va">unclassified_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="replace-specific-class-annotations">Replace Specific Class Annotations<a class="anchor" aria-label="anchor" href="#replace-specific-class-annotations"></a>
</h4>
<p>Replace all instances of a specific class with “unclassified” (class
id 1):</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get class2use</span></span>
<span><span class="va">class_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_names.html">ifcb_get_mat_names</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span><span class="op">)</span></span>
<span><span class="va">class2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_variable.html">ifcb_get_mat_variable</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span>,</span>
<span>                                   variable_name <span class="op">=</span> <span class="va">class_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the class id of Alexandrium_pseudogonyaulax</span></span>
<span><span class="va">ap_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Alexandrium_pseudogonyaulax"</span>,</span>
<span>                     <span class="va">class2use</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the class id of unclassified</span></span>
<span><span class="va">unclassified_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"unclassified"</span>,</span>
<span>                         <span class="va">class2use</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the python session if not already set up</span></span>
<span><span class="co"># env_path &lt;- "~/.virtualenvs/iRfcb"</span></span>
<span><span class="co"># ifcb_py_install(envname = env_path)</span></span>
<span></span>
<span><span class="co"># Move all Alexandrium_pseudogonyaulax images to unclassified</span></span>
<span><span class="fu"><a href="../reference/ifcb_replace_mat_values.html">ifcb_replace_mat_values</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                        out_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                        target_id <span class="op">=</span> <span class="va">ap_id</span>,</span>
<span>                        new_id <span class="op">=</span> <span class="va">unclassified_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-annotated-images">Extract Annotated Images<a class="anchor" aria-label="anchor" href="#extract-annotated-images"></a>
</h4>
<p>Extract annotated images, skipping the “unclassified” (class id 1)
category:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract .png images</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_annotated_images.html">ifcb_extract_annotated_images</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                              class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>                              roi_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                              out_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>                              skip_class <span class="op">=</span> <span class="fl">1</span>, <span class="co"># or "unclassified"</span></span>
<span>                              verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="verify-correction">Verify Correction<a class="anchor" aria-label="anchor" href="#verify-correction"></a>
</h4>
<p>Verify that the corrections have been applied:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize new counts after correction</span></span>
<span><span class="va">png_per_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_counts.html">ifcb_summarize_png_counts</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>                                           sum_level <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">png_per_class</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   class_name                         n_images</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Amphidnium-like                           1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Chaetoceros_spp_chain                     6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Chaetoceros_spp_single_cell               3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Ciliophora                               23</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Cryptomonadales                         245</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Cylindrotheca_Nitzschia_longissima       47</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="annotate-image">Annotate image<a class="anchor" aria-label="anchor" href="#annotate-image"></a>
</h4>
<p>Images can be batch annotated using the <a href="../reference/ifcb_annotate_batch.html"><code>ifcb_annotate_batch</code></a>
function. If a manual file already exists for the sample, the ROI class
list will be updated accordingly. If no file is found, a new .mat file
will be created, with all unannotated ROIs marked as unclassified.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read a file with selected images, generated by the image gallery app</span></span>
<span><span class="va">correction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"data/manual/correction/Alexandrium_pseudogonyaulax_selected_images.txt"</span>, </span>
<span>                         header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print image names to be annotated</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">correction</span><span class="op">$</span><span class="va">image_filename</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "D20220712T210855_IFCB134_00164.png" "D20220712T222710_IFCB134_00044.png"</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Re-annotate the images that were moved to unclassified earlier in the tutorial</span></span>
<span><span class="fu"><a href="../reference/ifcb_annotate_batch.html">ifcb_annotate_batch</a></span><span class="op">(</span>png_images <span class="op">=</span> <span class="va">correction</span><span class="op">$</span><span class="va">image_filename</span>,</span>
<span>                    class <span class="op">=</span> <span class="st">"Alexandrium_pseudogonyaulax"</span>,</span>
<span>                    manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                    adc_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                    class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize new counts after re-annotation</span></span>
<span><span class="va">mat_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_count_mat_annotations.html">ifcb_count_mat_annotations</a></span><span class="op">(</span>manual_files <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                                        class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>                                        skip_class <span class="op">=</span> <span class="st">"unclassified"</span>,</span>
<span>                                        sum_level <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output and check if Alexandrium pseudogonyaulax is back</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mat_count</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   class                           n</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Alexandrium_pseudogonyaulax     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Amphidnium-like                 1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Chaetoceros_spp_chain           6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Chaetoceros_spp_single_cell     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Ciliophora                     23</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Cryptomonadales               245</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="merge-manual-datasets">Merge Manual Datasets<a class="anchor" aria-label="anchor" href="#merge-manual-datasets"></a>
</h2>
<p>Datasets that have been manually annotated using the MATLAB code from
the <a href="https://github.com/hsosik/ifcb-analysis" class="external-link">ifcb-analysis</a>
repository (Sosik and Olson 2007) can be merged using the <a href="../reference/ifcb_merge_manual.html"><code>ifcb_merge_manual</code></a>
function. This is a wrapper function of the <a href="../reference/ifcb_create_class2use.html"><code>ifcb_create_class2use</code></a>,
<a href="../reference/ifcb_replace_mat_values.html"><code>ifcb_replace_mat_values</code></a>
and <a href="../reference/ifcb_adjust_classes.html"><code>ifcb_adjust_classes</code></a>
functions.</p>
<p>In this example, two datasets from the Swedish west coast are
downloaded from the <a href="https://doi.org/10.17044/scilifelab.25883455.v3" class="external-link">SMHI IFCB
Plankton Image Reference Library (version 3)</a> (Torstensson et
al. 2024) and combined into a single dataset. Please note that these
datasets are large, and the downloading and merging processes may take
considerable time.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define data directories</span></span>
<span><span class="va">skagerrak_kattegat_dir</span> <span class="op">&lt;-</span> <span class="st">"data_skagerrak_kattegat"</span></span>
<span><span class="va">tangesund_dir</span> <span class="op">&lt;-</span> <span class="st">"data_tangesund"</span></span>
<span><span class="va">merged_dir</span> <span class="op">&lt;-</span> <span class="st">"data_skagerrak_kattegat_tangesund_merged"</span></span>
<span></span>
<span><span class="co"># Download and extract Skagerrak-Kattegat data in the data folder</span></span>
<span><span class="fu"><a href="../reference/ifcb_download_test_data.html">ifcb_download_test_data</a></span><span class="op">(</span>dest_dir <span class="op">=</span> <span class="va">skagerrak_kattegat_dir</span>,</span>
<span>                        figshare_article <span class="op">=</span> <span class="st">"48158725"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download and extract Tångesund data in the data folder</span></span>
<span><span class="fu"><a href="../reference/ifcb_download_test_data.html">ifcb_download_test_data</a></span><span class="op">(</span>dest_dir <span class="op">=</span> <span class="va">tangesund_dir</span>,</span>
<span>                        figshare_article <span class="op">=</span> <span class="st">"48158731"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the python session if not already set up</span></span>
<span><span class="co"># env_path &lt;- "~/.virtualenvs/iRfcb"</span></span>
<span><span class="co"># ifcb_py_install(envname = env_path)</span></span>
<span></span>
<span><span class="co"># Merge Skagerrak-Kattegat and Tångesund to a single dataset</span></span>
<span><span class="fu"><a href="../reference/ifcb_merge_manual.html">ifcb_merge_manual</a></span><span class="op">(</span>class2use_file_base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">skagerrak_kattegat_dir</span>, <span class="st">"config/class2use.mat"</span><span class="op">)</span>,</span>
<span>                  class2use_file_additions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tangesund_dir</span>, <span class="st">"config/class2use.mat"</span><span class="op">)</span>,</span>
<span>                  class2use_file_output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">merged_dir</span>, <span class="st">"config/class2use.mat"</span><span class="op">)</span>,</span>
<span>                  manual_folder_base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">skagerrak_kattegat_dir</span>, <span class="st">"manual"</span><span class="op">)</span>,</span>
<span>                  manual_folder_additions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tangesund_dir</span>, <span class="st">"manual"</span><span class="op">)</span>,</span>
<span>                  manual_folder_output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">merged_dir</span>, <span class="st">"manual"</span><span class="op">)</span></span>
<span>                  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-annotated-images-for-publication">Prepare Annotated Images for Publication<a class="anchor" aria-label="anchor" href="#prepare-annotated-images-for-publication"></a>
</h2>
<div class="section level4">
<h4 id="summarize-image-metadata">Summarize Image Metadata<a class="anchor" aria-label="anchor" href="#summarize-image-metadata"></a>
</h4>
<p>This function gather feature and hdr data for every image in the
<code>png_folder</code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize image metadata from feature and hdr files</span></span>
<span><span class="va">image_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_metadata.html">ifcb_summarize_png_metadata</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>                                              feature_folder <span class="op">=</span> <span class="st">"data/features"</span>,</span>
<span>                                              hdr_folder <span class="op">=</span> <span class="st">"data/data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the first ten columns of output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">image_metadata</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                                image                 subfolder</span></span>
<span><span class="co">## 1 D20230915T093804_IFCB134_02133.png       Amphidnium-like_051</span></span>
<span><span class="co">## 2 D20230810T113059_IFCB134_00952.png Chaetoceros_spp_chain_018</span></span>
<span><span class="co">## 3 D20230810T113059_IFCB134_02303.png Chaetoceros_spp_chain_018</span></span>
<span><span class="co">## 4 D20230915T091133_IFCB134_00057.png Chaetoceros_spp_chain_018</span></span>
<span><span class="co">## 5 D20230915T093804_IFCB134_00507.png Chaetoceros_spp_chain_018</span></span>
<span><span class="co">## 6 D20230915T093804_IFCB134_00689.png Chaetoceros_spp_chain_018</span></span>
<span><span class="co">##                     sample           timestamp       date year month day</span></span>
<span><span class="co">## 1 D20230915T093804_IFCB134 2023-09-15 09:38:04 2023-09-15 2023     9  15</span></span>
<span><span class="co">## 2 D20230810T113059_IFCB134 2023-08-10 11:30:59 2023-08-10 2023     8  10</span></span>
<span><span class="co">## 3 D20230810T113059_IFCB134 2023-08-10 11:30:59 2023-08-10 2023     8  10</span></span>
<span><span class="co">## 4 D20230915T091133_IFCB134 2023-09-15 09:11:33 2023-09-15 2023     9  15</span></span>
<span><span class="co">## 5 D20230915T093804_IFCB134 2023-09-15 09:38:04 2023-09-15 2023     9  15</span></span>
<span><span class="co">## 6 D20230915T093804_IFCB134 2023-09-15 09:38:04 2023-09-15 2023     9  15</span></span>
<span><span class="co">##       time ifcb_number</span></span>
<span><span class="co">## 1 09:38:04     IFCB134</span></span>
<span><span class="co">## 2 11:30:59     IFCB134</span></span>
<span><span class="co">## 3 11:30:59     IFCB134</span></span>
<span><span class="co">## 4 09:11:33     IFCB134</span></span>
<span><span class="co">## 5 09:38:04     IFCB134</span></span>
<span><span class="co">## 6 09:38:04     IFCB134</span></span></code></pre>
<p>The output can be mapped with the headers in <a href="../reference/ifcb_get_ecotaxa_example.html"><code>ifcb_get_ecotaxa_example</code></a>
to produce metadata files suitable for submitting images to <a href="https://ecotaxa.obs-vlfr.fr/" class="external-link">EcoTaxa</a>.</p>
</div>
<div class="section level4">
<h4 id="png-directory-1">PNG Directory<a class="anchor" aria-label="anchor" href="#png-directory-1"></a>
</h4>
<p>Prepare the PNG directory for publication as a zip-archive, similar
to the files in the <a href="https://doi.org/10.17044/scilifelab.25883455" class="external-link">SMHI IFCB Plankton
Image Reference Library</a> (Torstensson et al. 2024):</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create zip-archive</span></span>
<span><span class="fu"><a href="../reference/ifcb_zip_pngs.html">ifcb_zip_pngs</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>              zip_filename <span class="op">=</span> <span class="st">"data/zip/ifcb_annotated_images_corrected.zip"</span>,</span>
<span>              readme_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata/README-template.md"</span>, </span>
<span>                                        package <span class="op">=</span> <span class="st">"iRfcb"</span><span class="op">)</span>, <span class="co"># Template icluded in `iRfcb`</span></span>
<span>              email_address <span class="op">=</span> <span class="st">"tutorial@test.com"</span>,</span>
<span>              version <span class="op">=</span> <span class="st">"1.1"</span>,</span>
<span>              print_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Creating README file...</span></span>
<span><span class="co">## Creating MANIFEST.txt...</span></span>
<span><span class="co">## Creating zip archive...</span></span>
<span><span class="co">## Zip archive created successfully: /home/runner/work/iRfcb/iRfcb/vignettes/data/zip/ifcb_annotated_images_corrected.zip</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="matlab-directory">MATLAB Directory<a class="anchor" aria-label="anchor" href="#matlab-directory"></a>
</h4>
<p>Prepare the MATLAB directory for publication as a zip-archive,
similar to the files in the <a href="https://doi.org/10.17044/scilifelab.25883455" class="external-link">SMHI IFCB Plankton
Image Reference Library</a>:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create zip-archive</span></span>
<span><span class="fu"><a href="../reference/ifcb_zip_matlab.html">ifcb_zip_matlab</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                features_folder <span class="op">=</span> <span class="st">"data/features"</span>,</span>
<span>                class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>                zip_filename <span class="op">=</span> <span class="st">"data/zip/ifcb_matlab_files_corrected.zip"</span>,</span>
<span>                data_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                readme_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata/README-template.md"</span>, </span>
<span>                                          package <span class="op">=</span> <span class="st">"iRfcb"</span><span class="op">)</span>, <span class="co"># Template icluded in `iRfcb`</span></span>
<span>                matlab_readme_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata/MATLAB-template.md"</span>, </span>
<span>                                                 package <span class="op">=</span> <span class="st">"iRfcb"</span><span class="op">)</span>, <span class="co"># Template icluded in `iRfcb`</span></span>
<span>                email_address <span class="op">=</span> <span class="st">"tutorial@test.com"</span>,</span>
<span>                version <span class="op">=</span> <span class="st">"1.1"</span>,</span>
<span>                print_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Listing all files...</span></span>
<span><span class="co">## Copying manual files...</span></span>
<span><span class="co">## Copying feature files...</span></span>
<span><span class="co">## Copying data files...</span></span>
<span><span class="co">## Copying class2use file...</span></span>
<span><span class="co">## Creating README file...</span></span>
<span><span class="co">## Creating MANIFEST.txt...</span></span>
<span><span class="co">## Creating zip archive...</span></span>
<span><span class="co">## Zip archive created successfully: /home/runner/work/iRfcb/iRfcb/vignettes/data/zip/ifcb_matlab_files_corrected.zip</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="create-manifest-txt">Create MANIFEST.txt<a class="anchor" aria-label="anchor" href="#create-manifest-txt"></a>
</h4>
<p>Create a manifest file for the zip packages:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create MANIFEST.txt of the zip folder content</span></span>
<span><span class="fu"><a href="../reference/ifcb_create_manifest.html">ifcb_create_manifest</a></span><span class="op">(</span><span class="st">"data/zip"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MANIFEST.txt has been created at data/zip/MANIFEST.txt</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="classified-results-from-matlab">Classified Results from MATLAB<a class="anchor" aria-label="anchor" href="#classified-results-from-matlab"></a>
</h2>
<div class="section level4">
<h4 id="extract-classified-results-from-a-sample">Extract Classified Results from a Sample<a class="anchor" aria-label="anchor" href="#extract-classified-results-from-a-sample"></a>
</h4>
<p>Extract classified results from a sample:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract all classified images from a sample</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_classified_images.html">ifcb_extract_classified_images</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="st">"D20230810T113059_IFCB134"</span>,</span>
<span>                               classified_folder <span class="op">=</span> <span class="st">"data/classified"</span>,</span>
<span>                               roi_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                               out_folder <span class="op">=</span> <span class="st">"data/classified_images"</span>,</span>
<span>                               taxa <span class="op">=</span> <span class="st">"All"</span>, <span class="co"># or specify a particular taxa</span></span>
<span>                               threshold <span class="op">=</span> <span class="st">"opt"</span><span class="op">)</span> <span class="co"># or specify another threshold</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 2747 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Heterocapsa_rotundata </span></span>
<span><span class="co">## Writing 519 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Cryptomonadales </span></span>
<span><span class="co">## Writing 464 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Dino_smaller_than_30unidentified </span></span>
<span><span class="co">## Writing 511 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/unclassified </span></span>
<span><span class="co">## Writing 6 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Ciliates </span></span>
<span><span class="co">## Writing 245 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Leptocylindrus_danicus_minimus </span></span>
<span><span class="co">## Writing 114 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Leptocylindrus_danicus </span></span>
<span><span class="co">## Writing 66 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Cylindrotheca_Nitzschia_longissima </span></span>
<span><span class="co">## Writing 23 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Chaetoceros_chain </span></span>
<span><span class="co">## Writing 6 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Dino_larger_than_30unidentified </span></span>
<span><span class="co">## Writing 23 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Prorocentrum_micans </span></span>
<span><span class="co">## Writing 51 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Scrippsiella_group </span></span>
<span><span class="co">## Writing 2 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Tripos_lineatus </span></span>
<span><span class="co">## Writing 1 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Cerataulina_pelagica </span></span>
<span><span class="co">## Writing 6 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Gymnodiniales_smaller_than_30 </span></span>
<span><span class="co">## Writing 3 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Chaetoceros_single_cell </span></span>
<span><span class="co">## Writing 5 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Skeletonema_marinoi </span></span>
<span><span class="co">## Writing 1 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Enisiculifera_carinata </span></span>
<span><span class="co">## Writing 2 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Thalassiosira_gravida </span></span>
<span><span class="co">## Writing 2 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Pseudo-nitzschia_spp </span></span>
<span><span class="co">## Writing 1 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Octactis_speculum </span></span>
<span><span class="co">## Writing 3 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Guinardia_delicatula </span></span>
<span><span class="co">## Writing 1 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Thalassiosira_nordenskioeldii</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="read-feature-data">Read feature data<a class="anchor" aria-label="anchor" href="#read-feature-data"></a>
</h4>
<p>Read all feature files (.csv) from a folder:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read feature files from a folder</span></span>
<span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_features.html">ifcb_read_features</a></span><span class="op">(</span><span class="st">"data/features/2023/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output of first 10 columns from the first sample in the list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   roi_number Area  Biovolume BoundingBox_xwidth BoundingBox_ywidth ConvexArea</span></span>
<span><span class="co">## 1          2  446   6082.909                 31                 21        542</span></span>
<span><span class="co">## 2          3 4326 142783.030                111                 63       5186</span></span>
<span><span class="co">## 3          4 9739 336908.323                202                129      10581</span></span>
<span><span class="co">## 4          5  580   9186.802                 27                 28        602</span></span>
<span><span class="co">## 5          6 3927 120366.981                 99                 50       4191</span></span>
<span><span class="co">## 6          7  290   3111.748                 22                 20        335</span></span>
<span><span class="co">##   ConvexPerimeter Eccentricity EquivDiameter    Extent</span></span>
<span><span class="co">## 1        87.24196    0.6006111      23.82991 0.6850998</span></span>
<span><span class="co">## 2       291.42030    0.8980639      74.21613 0.6186186</span></span>
<span><span class="co">## 3       505.83898    0.9753657     111.35565 0.3737432</span></span>
<span><span class="co">## 4        88.58696    0.3299815      27.17497 0.7671958</span></span>
<span><span class="co">## 5       265.49548    0.9016151      70.71076 0.7933333</span></span>
<span><span class="co">## 6        67.86613    0.3332706      19.21560 0.6590909</span></span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read only multiblob feature files</span></span>
<span><span class="va">multiblob_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_features.html">ifcb_read_features</a></span><span class="op">(</span><span class="st">"data/features/2023"</span>, </span>
<span>                                         multiblob <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output of first 10 columns from the first sample in the list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">multiblob_features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   roi_number blob_number Area MajorAxisLength MinorAxisLength Eccentricity</span></span>
<span><span class="co">## 1        154           1 3647       109.93092        45.00010    0.9123779</span></span>
<span><span class="co">## 2        154           2 1626        77.53922        30.74631    0.9180235</span></span>
<span><span class="co">## 3        214           1 7456       232.11148       122.61037    0.8490956</span></span>
<span><span class="co">## 4        214           2 4840       101.68493        68.30606    0.7407850</span></span>
<span><span class="co">## 5        214           3  910        54.18655        28.51088    0.8503847</span></span>
<span><span class="co">## 6        214           4  153        18.95031        10.93057    0.8168844</span></span>
<span><span class="co">##   Orientation ConvexArea EquivDiameter  Solidity</span></span>
<span><span class="co">## 1    11.28171       4205      68.14327 0.8673008</span></span>
<span><span class="co">## 2    26.71876       2495      45.50041 0.6517034</span></span>
<span><span class="co">## 3    30.89332      23666      97.43343 0.3150511</span></span>
<span><span class="co">## 4   -35.88789       6955      78.50146 0.6959022</span></span>
<span><span class="co">## 5    27.00911       1551      34.03892 0.5867182</span></span>
<span><span class="co">## 6    48.78767        188      13.95728 0.8138298</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="read-a-summary-file">Read a Summary File<a class="anchor" aria-label="anchor" href="#read-a-summary-file"></a>
</h4>
<p>Read a summary file:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read a MATLAB summary file generated by `countcells_allTBnew_user_training`</span></span>
<span><span class="va">summary_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_summary.html">ifcb_read_summary</a></span><span class="op">(</span><span class="st">"data/classified/2023/summary/summary_allTB_2023.mat"</span>,</span>
<span>                                  biovolume <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  threshold <span class="op">=</span> <span class="st">"opt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">##   sample   timestamp           date        year month   day time     ifcb_number</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;time&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D202308… 2023-08-10 <span style="color: #949494;">11:30:59</span> 2023-08-10  <span style="text-decoration: underline;">2</span>023     8    10 11<span style="color: #949494;">:</span>30<span style="color: #949494;">:</span>59 IFCB134    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D202308… 2023-08-10 <span style="color: #949494;">11:30:59</span> 2023-08-10  <span style="text-decoration: underline;">2</span>023     8    10 11<span style="color: #949494;">:</span>30<span style="color: #949494;">:</span>59 IFCB134    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D202308… 2023-08-10 <span style="color: #949494;">11:30:59</span> 2023-08-10  <span style="text-decoration: underline;">2</span>023     8    10 11<span style="color: #949494;">:</span>30<span style="color: #949494;">:</span>59 IFCB134    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D202308… 2023-08-10 <span style="color: #949494;">11:30:59</span> 2023-08-10  <span style="text-decoration: underline;">2</span>023     8    10 11<span style="color: #949494;">:</span>30<span style="color: #949494;">:</span>59 IFCB134    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D202308… 2023-08-10 <span style="color: #949494;">11:30:59</span> 2023-08-10  <span style="text-decoration: underline;">2</span>023     8    10 11<span style="color: #949494;">:</span>30<span style="color: #949494;">:</span>59 IFCB134    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> D202308… 2023-08-10 <span style="color: #949494;">11:30:59</span> 2023-08-10  <span style="text-decoration: underline;">2</span>023     8    10 11<span style="color: #949494;">:</span>30<span style="color: #949494;">:</span>59 IFCB134    </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4 more variables: ml_analyzed &lt;dbl&gt;, species &lt;chr&gt;, counts &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   counts_per_liter &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level4">
<h4 id="summarize-counts-biovolumes-and-carbon-content-from-classified-ifcb-data">Summarize counts, biovolumes and carbon content from classified IFCB
data<a class="anchor" aria-label="anchor" href="#summarize-counts-biovolumes-and-carbon-content-from-classified-ifcb-data"></a>
</h4>
<p>This function calculates aggregated biovolumes and carbon content
from Imaging FlowCytobot (IFCB) samples based on feature and MATLAB
classification result files, without summarizing the data in MATLAB.
Biovolumes are converted to carbon according to Menden-Deuer and Lessard
(2000) for individual regions of interest (ROI), where different
conversion factors are applied to diatoms and non-diatom protist. If
provided, it also incorporates sample volume data from HDR files to
compute biovolume and carbon content per liter of sample. See details in
the help pages for <a href="../reference/ifcb_summarize_biovolumes.html"><code>ifcb_summarize_biovolumes</code></a>
and <a href="../reference/ifcb_extract_biovolumes.html"><code>ifcb_extract_biovolumes</code></a>.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize biovolume data using IFCB data from classified data folder</span></span>
<span><span class="va">biovolume_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_biovolumes.html">ifcb_summarize_biovolumes</a></span><span class="op">(</span>feature_folder <span class="op">=</span> <span class="st">"data/features/2023"</span>,</span>
<span>                                            mat_folder <span class="op">=</span> <span class="st">"data/classified"</span>,</span>
<span>                                            hdr_folder <span class="op">=</span> <span class="st">"data/data/2023"</span>,</span>
<span>                                            micron_factor <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3.4</span>,</span>
<span>                                            diatom_class <span class="op">=</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span>                                            threshold <span class="op">=</span> <span class="st">"opt"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO: The following classes are considered NOT diatoms for carbon calculations:</span></span>
<span><span class="co">## Ciliates</span></span>
<span><span class="co">## Cryptomonadales</span></span>
<span><span class="co">## Dino_larger_than_30unidentified</span></span>
<span><span class="co">## Dino_smaller_than_30unidentified</span></span>
<span><span class="co">## Enisiculifera_carinata</span></span>
<span><span class="co">## Gymnodiniales_smaller_than_30</span></span>
<span><span class="co">## Heterocapsa_rotundata</span></span>
<span><span class="co">## Octactis_speculum</span></span>
<span><span class="co">## Prorocentrum_micans</span></span>
<span><span class="co">## Scrippsiella_group</span></span>
<span><span class="co">## Tripos_lineatus</span></span>
<span><span class="co">## unclassified</span></span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">biovolume_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">##   sample             classifier class counts biovolume_mm3 carbon_ug ml_analyzed</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D20230810T113059_… <span style="color: #949494;">"</span>Z:\\data… Cera…      1    0.000<span style="text-decoration: underline;">001</span>75 0.000<span style="text-decoration: underline;">083</span>9        3.17</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D20230810T113059_… <span style="color: #949494;">"</span>Z:\\data… Chae…     23    0.000<span style="text-decoration: underline;">017</span>6  0.000<span style="text-decoration: underline;">901</span>         3.17</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D20230810T113059_… <span style="color: #949494;">"</span>Z:\\data… Chae…      3    0.000<span style="text-decoration: underline;">001</span>18 0.000<span style="text-decoration: underline;">067</span>4        3.17</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D20230810T113059_… <span style="color: #949494;">"</span>Z:\\data… Cili…      6    0.000<span style="text-decoration: underline;">011</span>7  0.001<span style="text-decoration: underline;">59</span>          3.17</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D20230810T113059_… <span style="color: #949494;">"</span>Z:\\data… Cryp…    519    0.000<span style="text-decoration: underline;">097</span>1  0.015<span style="text-decoration: underline;">1</span>           3.17</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> D20230810T113059_… <span style="color: #949494;">"</span>Z:\\data… Cyli…     66    0.000<span style="text-decoration: underline;">016</span>8  0.001<span style="text-decoration: underline;">01</span>          3.17</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: counts_per_liter &lt;dbl&gt;, biovolume_mm3_per_liter &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   carbon_ug_per_liter &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level4">
<h4 id="summarize-counts-biovolumes-and-carbon-content-from-manually-annotated-ifcb-data">Summarize counts, biovolumes and carbon content from manually
annotated IFCB data<a class="anchor" aria-label="anchor" href="#summarize-counts-biovolumes-and-carbon-content-from-manually-annotated-ifcb-data"></a>
</h4>
<p>The <a href="../reference/ifcb_summarize_biovolumes.html"><code>ifcb_summarize_biovolumes</code></a>
function can also be used to calculate aggregated biovolumes and carbon
content from manually annotated Imaging FlowCytobot (IFCB) image data.
See details in the help pages for <a href="../reference/ifcb_summarize_biovolumes.html"><code>ifcb_summarize_biovolumes</code></a>,
<a href="../reference/ifcb_extract_biovolumes.html"><code>ifcb_extract_biovolumes</code></a>
and <a href="../reference/ifcb_count_mat_annotations.html"><code>ifcb_count_mat_annotations</code></a>.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize biovolume data using IFCB data from manual data folder</span></span>
<span><span class="va">manual_biovolume_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_biovolumes.html">ifcb_summarize_biovolumes</a></span><span class="op">(</span>feature_folder <span class="op">=</span> <span class="st">"data/features"</span>,</span>
<span>                                                   mat_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                                                   class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>                                                   hdr_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                                                   micron_factor <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3.4</span>,</span>
<span>                                                   diatom_class <span class="op">=</span> <span class="st">"Bacillariophyceae"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO: The following classes are considered NOT diatoms for carbon calculations:</span></span>
<span><span class="co">## Alexandrium_pseudogonyaulax</span></span>
<span><span class="co">## Amphidnium-like</span></span>
<span><span class="co">## Ciliophora</span></span>
<span><span class="co">## Cryptomonadales</span></span>
<span><span class="co">## Dinobryon_spp</span></span>
<span><span class="co">## Dinoflagellate_larger_than_30unidentified</span></span>
<span><span class="co">## Dinoflagellate_smaller_than_30unidentified</span></span>
<span><span class="co">## Dinophysis_acuminata</span></span>
<span><span class="co">## Enisiculifera_carinata</span></span>
<span><span class="co">## Gonyaulax_spp</span></span>
<span><span class="co">## Gyrodinium_spirale</span></span>
<span><span class="co">## Heterocapsa_Azadinium</span></span>
<span><span class="co">## Heterocapsa_rotundata</span></span>
<span><span class="co">## Karenia_mikimotoi</span></span>
<span><span class="co">## Katodinium-like</span></span>
<span><span class="co">## Mesodinium_rubrum</span></span>
<span><span class="co">## Octactis_speculum</span></span>
<span><span class="co">## Prorocentrum_micans</span></span>
<span><span class="co">## Prorocentrum_triestinum</span></span>
<span><span class="co">## Protoperidinium_spp</span></span>
<span><span class="co">## Scrippsiella_group</span></span>
<span><span class="co">## Strombidium-like</span></span>
<span><span class="co">## Torodinium_robustum</span></span>
<span><span class="co">## Tripos_furca</span></span>
<span><span class="co">## Tripos_lineatus</span></span>
<span><span class="co">## unclassified</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">manual_biovolume_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">##   sample             classifier class counts biovolume_mm3 carbon_ug ml_analyzed</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D20220522T000439_… <span style="color: #BB0000;">NA</span>         Cili…      1    0.000<span style="text-decoration: underline;">003</span>27  0.000<span style="text-decoration: underline;">432</span>        4.86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D20220522T000439_… <span style="color: #BB0000;">NA</span>         Meso…      4    0.000<span style="text-decoration: underline;">027</span>4   0.003<span style="text-decoration: underline;">44</span>         4.86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D20220522T000439_… <span style="color: #BB0000;">NA</span>         Stro…      1    0.000<span style="text-decoration: underline;">003</span>86  0.000<span style="text-decoration: underline;">504</span>        4.86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D20220522T000439_… <span style="color: #BB0000;">NA</span>         uncl…      1    0.000<span style="text-decoration: underline;">002</span>88  0.000<span style="text-decoration: underline;">384</span>        4.86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D20220522T003051_… <span style="color: #BB0000;">NA</span>         Meso…      2    0.000<span style="text-decoration: underline;">012</span>2   0.001<span style="text-decoration: underline;">55</span>         2.98</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> D20220712T210855_… <span style="color: #BB0000;">NA</span>         Alex…      1    0.000<span style="text-decoration: underline;">016</span>0   0.001<span style="text-decoration: underline;">91</span>         4.91</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: counts_per_liter &lt;dbl&gt;, biovolume_mm3_per_liter &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   carbon_ug_per_liter &lt;dbl&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="taxonomical-data">Taxonomical Data<a class="anchor" aria-label="anchor" href="#taxonomical-data"></a>
</h2>
<div class="section level4">
<h4 id="check-whether-a-class-name-is-a-diatom">Check whether a class name is a diatom<a class="anchor" aria-label="anchor" href="#check-whether-a-class-name-is-a-diatom"></a>
</h4>
<p>This function takes a list of taxa names, cleans them, retrieves
their corresponding classification records from the World Register of
Marine Species (WoRMS), and checks if they belong to the specified
diatom class. The function only uses the first name (genus name) of each
taxa for classification. This function can be useful for converting
biovolumes to carbon according to Menden-Deuer and Lessard (2000). See
<a href="../reference/vol2C_nondiatom.html"><code>iRfcb:::vol2C_nondiatom</code></a>
and <a href="../reference/vol2C_lgdiatom.html"><code>iRfcb:::vol2C_lgdiatom</code></a>
for carbon calculations (not included in NAMESPACE).</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read class2use file</span></span>
<span><span class="va">class2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_variable.html">ifcb_get_mat_variable</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a dataframe with class name and result from `ifcb_is_diatom`</span></span>
<span><span class="va">class_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">class2use</span>,</span>
<span>                         is_diatom <span class="op">=</span> <span class="fu"><a href="../reference/ifcb_is_diatom.html">ifcb_is_diatom</a></span><span class="op">(</span><span class="va">class2use</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print rows 10-15 of result</span></span>
<span><span class="va">class_list</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">15</span>,<span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                     class2use is_diatom</span></span>
<span><span class="co">## 10        Nodularia_spumigena     FALSE</span></span>
<span><span class="co">## 11            Cryptomonadales     FALSE</span></span>
<span><span class="co">## 12    Acanthoica_quattrospina     FALSE</span></span>
<span><span class="co">## 13 Asterionellopsis_glacialis      TRUE</span></span>
<span><span class="co">## 14                  Centrales      TRUE</span></span>
<span><span class="co">## 15            Centrales_chain      TRUE</span></span></code></pre>
<p>The default class for diatoms is defined as Bacillariophyceae, but
may be adjusted using the <code>diatom_class</code> argument.</p>
</div>
<div class="section level4">
<h4 id="find-trophic-type-of-plankton-taxa">Find trophic type of plankton taxa<a class="anchor" aria-label="anchor" href="#find-trophic-type-of-plankton-taxa"></a>
</h4>
<p>This function takes a list of taxa names and matches them with the
<code>SMHI Trophic Type</code> list used in <a href="https://sharkweb.smhi.se/hamta-data/" class="external-link">SHARK</a>.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example taxa names</span></span>
<span><span class="va">taxa_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Acanthoceras zachariasii"</span>,</span>
<span>               <span class="st">"Nodularia spumigena"</span>,</span>
<span>               <span class="st">"Acanthoica quattrospina"</span>,</span>
<span>               <span class="st">"Noctiluca"</span>,</span>
<span>               <span class="st">"Gymnodiniales"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get trophic type for taxa</span></span>
<span><span class="va">trophic_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_trophic_type.html">ifcb_get_trophic_type</a></span><span class="op">(</span><span class="va">taxa_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trophic_type</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "AU" "AU" "MX" "HT" "NS"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="shark-export">SHARK export<a class="anchor" aria-label="anchor" href="#shark-export"></a>
</h2>
<p>This function is used by SMHI to map IFCB data into the <a href="https://sharkweb.smhi.se/hamta-data/" class="external-link">SHARK</a> standard data
delivery format. An example submission is also provided in
<code>iRfcb</code>.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get column names from example</span></span>
<span><span class="va">shark_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_shark_colnames.html">ifcb_get_shark_colnames</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print column names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">shark_colnames</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] MYEAR                     STATN                    </span></span>
<span><span class="co">##  [3] SAMPLING_PLATFORM         PROJ                     </span></span>
<span><span class="co">##  [5] ORDERER                   SHIPC                    </span></span>
<span><span class="co">##  [7] CRUISE_NO                 DATE_TIME                </span></span>
<span><span class="co">##  [9] SDATE                     STIME                    </span></span>
<span><span class="co">## [11] TIMEZONE                  LATIT                    </span></span>
<span><span class="co">## [13] LONGI                     POSYS                    </span></span>
<span><span class="co">## [15] WADEP                     MPROG                    </span></span>
<span><span class="co">## [17] MNDEP                     MXDEP                    </span></span>
<span><span class="co">## [19] SLABO                     ACKR_SMP                 </span></span>
<span><span class="co">## [21] SMTYP                     PDMET                    </span></span>
<span><span class="co">## [23] SMVOL                     METFP                    </span></span>
<span><span class="co">## [25] IFCBNO                    SMPNO                    </span></span>
<span><span class="co">## [27] LATNM                     SFLAG                    </span></span>
<span><span class="co">## [29] TRPHY                     APHIA_ID                 </span></span>
<span><span class="co">## [31] IMAGE_VERIFICATION        COUNT                    </span></span>
<span><span class="co">## [33] ABUND                     BIOVOL                   </span></span>
<span><span class="co">## [35] C_CONC                    QFLAG                    </span></span>
<span><span class="co">## [37] COEFF                     CLASS_NAME               </span></span>
<span><span class="co">## [39] CLASS_F1                  UNCLASSIFIED_COUNTS      </span></span>
<span><span class="co">## [41] UNCLASSIFIED_ABUNDANCE    UNCLASSIFIED_VOLUME      </span></span>
<span><span class="co">## [43] METOA                     COUNTPROG                </span></span>
<span><span class="co">## [45] ALABO                     ACKR_ANA                 </span></span>
<span><span class="co">## [47] ANADATE                   METDC                    </span></span>
<span><span class="co">## [49] TRAINING_SET              TRAINING_SET_ANNOTATED_BY</span></span>
<span><span class="co">## [51] CLASSIFIER_CREATED_BY     CLASSIFIER_USED          </span></span>
<span><span class="co">## [53] MANUAL_QC_DATE            PRE_FILTER_SIZE          </span></span>
<span><span class="co">## [55] PH_FB                     CHL_FB                   </span></span>
<span><span class="co">## [57] CDOM_FB                   PHYC_FB                  </span></span>
<span><span class="co">## [59] PHER_FB                   WATERFLOW_FB             </span></span>
<span><span class="co">## [61] TURB_FB                   PCO2_FB                  </span></span>
<span><span class="co">## [63] TEMP_FB                   PSAL_FB                  </span></span>
<span><span class="co">## [65] OSAT_FB                   DOXY_FB                  </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load example stored from `iRfcb`</span></span>
<span><span class="va">shark_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_shark_example.html">ifcb_get_shark_example</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print first ten columns of the SHARK data submission example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">shark_example</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   MYEAR                  STATN SAMPLING_PLATFORM              PROJ ORDERER</span></span>
<span><span class="co">## 1  2022 RV_FB_D20220713T175838              IFCB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">## 2  2022 RV_FB_D20220713T175838              IFCB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">## 3  2022 RV_FB_D20220713T175838              IFCB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">## 4  2022 RV_FB_D20220713T175838              IFCB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">## 5  2022 RV_FB_D20220713T175838            SveaFB IFCB, DTO, JERICO    SMHI</span></span>
<span><span class="co">##   SHIPC CRUISE_NO   DATE_TIME      SDATE    STIME</span></span>
<span><span class="co">## 1  77SE        12 2,02207E+13 2022-07-13 17:58:38</span></span>
<span><span class="co">## 2  77SE        12 2,02207E+13 2022-07-13 17:58:38</span></span>
<span><span class="co">## 3  77SE        12 2,02207E+13 2022-07-13 17:58:38</span></span>
<span><span class="co">## 4  77SE        12 2,02207E+13 2022-07-13 17:58:38</span></span>
<span><span class="co">## 5  77SE        12 2,02207E+13 2022-07-13 17:58:38</span></span></code></pre>
<p>This concludes the tutorial for the <code>iRfcb</code> package. For
more detailed information, refer to the package documentation. See how
data pipelines can be constructed using <code>iRfcb</code> in the
following <a href="https://github.com/nodc-sweden/ifcb-data-pipeline" class="external-link">Example
Project</a>. Happy analyzing!</p>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<pre><code><span><span class="co">## To cite package 'iRfcb' in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Anders Torstensson (2024). I 'R' FlowCytobot (iRfcb): Tools for</span></span>
<span><span class="co">##   Analyzing and Processing Data from the IFCB. R package version</span></span>
<span><span class="co">##   0.3.13. https://doi.org/10.5281/zenodo.12533225</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Manual{,</span></span>
<span><span class="co">##     title = {I 'R' FlowCytobot (iRfcb): Tools for Analyzing and Processing Data from the IFCB},</span></span>
<span><span class="co">##     author = {Anders Torstensson},</span></span>
<span><span class="co">##     year = {2024},</span></span>
<span><span class="co">##     note = {R package version 0.3.13},</span></span>
<span><span class="co">##     url = {https://doi.org/10.5281/zenodo.12533225},</span></span>
<span><span class="co">##   }</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Hayashi, K., Walton, J., Lie, A., Smith, J. and Kudela M. Using
particle size distribution (PSD) to automate imaging flow cytobot (IFCB)
data quality in coastal California, USA. In prep.</li>
<li>Menden-Deuer Susanne, Lessard Evelyn J., (2000), Carbon to volume
relationships for dinoflagellates, diatoms, and other protist plankton,
Limnology and Oceanography, 3, doi: 10.4319/lo.2000.45.3.0569.</li>
<li>Sosik, H. M. and Olson, R. J. (2007) Automated taxonomic
classification of phytoplankton sampled with imaging-in-flow cytometry.
Limnol. Oceanogr: Methods 5, 204–216.</li>
<li>Torstensson, A., Skjevik, A-T., Mohlin, M., Karlberg, M. and
Karlson, B. (2024). SMHI IFCB Plankton Image Reference Library.
SciLifeLab. Dataset. <a href="https://doi.org/10.17044/scilifelab.25883455.v3" class="external-link uri">https://doi.org/10.17044/scilifelab.25883455.v3</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anders Torstensson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

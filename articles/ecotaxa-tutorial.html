<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Prepare IFCB Images for EcoTaxa • iRfcb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare IFCB Images for EcoTaxa">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">iRfcb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/a-general-tutorial.html">iRfcb Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/qc-tutorial.html">Quality Control of IFCB Data</a></li>
    <li><a class="dropdown-item" href="../articles/matlab-tutorial.html">Handling MATLAB Results</a></li>
    <li><a class="dropdown-item" href="../articles/dwca-tutorial.html">Creating a DwC-A from IFCB Data</a></li>
    <li><a class="dropdown-item" href="../articles/image-export-tutorial.html">Sharing Annotated IFCB Images</a></li>
    <li><a class="dropdown-item" href="../articles/ecotaxa-tutorial.html">Prepare IFCB Images for EcoTaxa</a></li>
    <li><a class="dropdown-item" href="../articles/whoi-plankton-data-integration.html">WHOI-Plankton Data Integration</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EuropeanIFCBGroup/iRfcb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Prepare IFCB Images for EcoTaxa</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EuropeanIFCBGroup/iRfcb/blob/main/vignettes/ecotaxa-tutorial.Rmd" class="external-link"><code>vignettes/ecotaxa-tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>ecotaxa-tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to prepare Imaging FlowCytobot (IFCB)
data for <a href="https://ecotaxa.obs-vlfr.fr/" class="external-link">EcoTaxa</a> in R using
the <code>iRfcb</code> package. This tutorial covers the export of both
unclassified raw IFCB images and annotated Regions of Interest (ROIs)
using the MATLAB code from the <a href="https://github.com/hsosik/ifcb-analysis" class="external-link"><code>ifcb-analysis</code></a>
repository (Sosik and Olson, 2007). However, the code can be adapted to
process images from other software platforms. The code can also be
adapted to submit automatically classified images using the
<code><a href="../reference/ifcb_extract_classified_images.html">ifcb_extract_classified_images()</a></code> function.</p>
<p>EcoTaxa is a web application widely used for hosting, classifying,
and exporting images of individual objects, particularly in plankton
imaging. It leverages machine learning to assign names based on a
universal taxonomy and produces ecological data in standardized formats
for scientific applications. To submit images, accompanying metadata is
required, which can be generated using the <code>iRfcb</code>
package.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>You can install the package from CRAN using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"iRfcb"</span><span class="op">)</span></span></code></pre></div>
<p>Load the required libraries:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://europeanifcbgroup.github.io/iRfcb/">iRfcb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># For data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span> <span class="co"># For creating .tsv files</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span> <span class="co"># For handling dates</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-sample-data">Download Sample Data<a class="anchor" aria-label="anchor" href="#download-sample-data"></a>
</h3>
<p>To get started, download sample data from the <a href="https://doi.org/10.17044/scilifelab.25883455.v3" class="external-link">SMHI IFCB
Plankton Image Reference Library</a> (Torstensson et al. 2024) with the
following function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define data directory</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="st">"data"</span></span>
<span></span>
<span><span class="co"># Download and extract test data in the data folder</span></span>
<span><span class="fu"><a href="../reference/ifcb_download_test_data.html">ifcb_download_test_data</a></span><span class="op">(</span></span>
<span>  dest_dir <span class="op">=</span> <span class="va">data_dir</span>,</span>
<span>  max_retries <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  sleep_time <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="unclassified-images">Unclassified Images<a class="anchor" aria-label="anchor" href="#unclassified-images"></a>
</h2>
<p>This example demonstrates how to prepare a single IFCB sample for
submission to EcoTaxa as a zip-archive.</p>
<div class="section level3">
<h3 id="extract-images">Extract Images<a class="anchor" aria-label="anchor" href="#extract-images"></a>
</h3>
<p>Extract all ROIs from a sample as <code>.png</code> images:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define path to sample that you wish to prepare for a EcoTaxa submission</span></span>
<span><span class="va">sample_path</span> <span class="op">&lt;-</span> <span class="st">"data/data/2023/D20230314/D20230314T003836_IFCB134"</span></span>
<span></span>
<span><span class="co"># Extract .png images</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_pngs.html">ifcb_extract_pngs</a></span><span class="op">(</span><span class="va">sample_path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 1122 ROIs from D20230314T003836_IFCB134.roi to data/data/2023/D20230314/D20230314T003836_IFCB134</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="summarize-image-metadata">Summarize Image Metadata<a class="anchor" aria-label="anchor" href="#summarize-image-metadata"></a>
</h3>
<p>Extract image metadata from the <code>.png</code> directory:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract image metadata</span></span>
<span><span class="va">metadata_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_metadata.html">ifcb_summarize_png_metadata</a></span><span class="op">(</span><span class="va">sample_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="map-ecotaxa-headers">Map EcoTaxa Headers<a class="anchor" aria-label="anchor" href="#map-ecotaxa-headers"></a>
</h3>
<p>The image metadata are mapped to the EcoTaxa metadata headers that
are required when submitting data to EcoTaxa. In this example, a minimal
dataset is used, containing only the image name. More comprehensive
headers can be specified through the arguments of
<code><a href="../reference/ifcb_get_ecotaxa_example.html">ifcb_get_ecotaxa_example()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the minimal EcoTaxa metadata header names</span></span>
<span><span class="va">ecotaxa_minimal_headers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_ecotaxa_example.html">ifcb_get_ecotaxa_example</a></span><span class="op">(</span><span class="st">"minimal"</span><span class="op">)</span><span class="op">[</span><span class="fl">0</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Create a data frame with empty rows matching the length of data</span></span>
<span><span class="va">ecotaxa_minimal_headers</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">metadata_sample</span><span class="op">)</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Map metadata to EcoTaxa headers</span></span>
<span><span class="va">ecotaxa_minimal</span> <span class="op">&lt;-</span> <span class="va">ecotaxa_minimal_headers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    img_file_name <span class="op">=</span> <span class="va">metadata_sample</span><span class="op">$</span><span class="va">image</span>,</span>
<span>    object_id <span class="op">=</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="va">metadata_sample</span><span class="op">$</span><span class="va">image</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-ecotaxa-tsv-and-zip-files">Generate EcoTaxa TSV and ZIP Files<a class="anchor" aria-label="anchor" href="#generate-ecotaxa-tsv-and-zip-files"></a>
</h3>
<p>The metadata for all images in the subfolder are stored in a
<code>.tsv</code> file, and a zipped archive is prepared for submission
to EcoTaxa.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Write metadata tsv file</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">ecotaxa_minimal</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>            <span class="va">sample_path</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ecotaxa_D20230314T003836_IFCB134.tsv"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create zip-archive</span></span>
<span><span class="fu"><a href="../reference/ifcb_zip_pngs.html">ifcb_zip_pngs</a></span><span class="op">(</span></span>
<span>  png_folder <span class="op">=</span> <span class="st">"data/data/2023/D20230314/"</span>,</span>
<span>  zip_filename <span class="op">=</span> <span class="st">"data/zip/D20230314T003836_IFCB134_ecotaxa.zip"</span>,</span>
<span>  include_txt <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="co"># To include the metadata text-files in the archive</span></span>
<span>  split_zip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  max_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  print_progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Creating zip archive...</span></span>
<span><span class="co">## Zip archive created successfully: /home/runner/work/iRfcb/iRfcb/vignettes/data/zip/D20230314T003836_IFCB134_ecotaxa.zip</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="annotated-images">Annotated Images<a class="anchor" aria-label="anchor" href="#annotated-images"></a>
</h2>
<p>This example demonstrates how to prepare a dataset of manually
annotated images for submission to EcoTaxa. The annotations were
generated using MATLAB code from the <a href="https://github.com/hsosik/ifcb-analysis" class="external-link"><code>ifcb-analysis</code></a>
repository (Sosik and Olson, 2007).</p>
<div class="section level3">
<h3 id="extract-annotated-images">Extract Annotated Images<a class="anchor" aria-label="anchor" href="#extract-annotated-images"></a>
</h3>
<p>Extract annotated ROIs as <code>.png</code> images in subfolders for
each class, skipping the <strong>unclassified</strong> (class id 1)
category:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract .png images</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_annotated_images.html">ifcb_extract_annotated_images</a></span><span class="op">(</span></span>
<span>  manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>  class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>  roi_folders <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>  out_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>  skip_class <span class="op">=</span> <span class="fl">1</span>, <span class="co"># or "unclassified"</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Do not print messages</span></span>
<span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summarize-image-metadata-1">Summarize Image Metadata<a class="anchor" aria-label="anchor" href="#summarize-image-metadata-1"></a>
</h3>
<p>This section demonstrates how to gather and summarize metadata for
images in the <code>png_folder</code> by combining data from feature and
<code>.hdr</code> files. Additionally, it retrieves the analysis date
and time for each sample based on <code>.mat</code> file creation dates
and appends this information to the summarized dataset.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize image metadata from feature and hdr files</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_metadata.html">ifcb_summarize_png_metadata</a></span><span class="op">(</span></span>
<span>  png_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>  feature_folder <span class="op">=</span> <span class="st">"data/features"</span>,</span>
<span>  hdr_folder <span class="op">=</span> <span class="st">"data/data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the first ten columns of output</span></span>
<span><span class="va">manual_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/manual"</span>, pattern <span class="op">=</span> <span class="st">".mat"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get file info the the .mat files</span></span>
<span><span class="va">file_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">manual_files</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract analysis date and time based file timestamps</span></span>
<span><span class="va">analysis_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".mat$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">manual_files</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  analysis_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">file_info</span><span class="op">$</span><span class="va">ctime</span><span class="op">)</span>,</span>
<span>  analysis_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="va">file_info</span><span class="op">$</span><span class="va">ctime</span><span class="op">)</span>, <span class="st">"%H:%M:%S"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge with metadata</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">analysis_date</span>, by <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="taxonomic-data-cleaning-and-retrieval">Taxonomic Data Cleaning and Retrieval<a class="anchor" aria-label="anchor" href="#taxonomic-data-cleaning-and-retrieval"></a>
</h3>
<p>Class names often contain unnecessary or inconsistent information.
These names need to be cleaned before mapping them to higher taxonomic
levels using external sources like <a href="https://www.marinespecies.org/" class="external-link">WoRMS</a>. The following code
demonstrates how to clean class names and retrieve taxonomic details
from WoRMS, such as <strong>AphiaID</strong>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get taxa names</span></span>
<span><span class="va">taxa_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">subfolder</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean taxa_names by substituting specific patterns with spaces or empty strings</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu">iRfcb</span><span class="fu">:::</span><span class="fu">truncate_folder_name</span><span class="op">(</span><span class="va">taxa_names</span><span class="op">)</span> <span class="co"># Remove numerics from folder name</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" single cell"</span>, <span class="st">""</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" chain"</span>, <span class="st">""</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-like"</span>, <span class="st">""</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" larger than 30unidentified"</span>, <span class="st">""</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" smaller than 30unidentified"</span>, <span class="st">""</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove species flags from class names</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\&lt;spp\\&gt;"</span>, <span class="st">""</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"  "</span>, <span class="st">" "</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Turn f to f. for forma</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\bf\\b"</span>, <span class="st">"f."</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add "/" for multiple names with capital letters</span></span>
<span><span class="co"># e.g. Heterocapsa_Azadinium to Heterocapsa/Azadinium</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" ([A-Z])"</span>, <span class="st">"/\\1"</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" ([A-Z])"</span>, <span class="st">"/\\1"</span>, <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove any whitespace</span></span>
<span><span class="va">taxa_names_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve worms records</span></span>
<span><span class="va">worms_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_match_taxa_names.html">ifcb_match_taxa_names</a></span><span class="op">(</span><span class="va">taxa_names_clean</span>,</span>
<span>                                       marine_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data frame with taxa information and class names</span></span>
<span><span class="va">class_names</span> <span class="op">&lt;-</span> <span class="va">worms_records</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>subfolder <span class="op">=</span> <span class="va">taxa_names</span>, class_clean <span class="op">=</span> <span class="va">taxa_names_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge with metadata</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">class_names</span>, by <span class="op">=</span> <span class="st">"subfolder"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="map-ecotaxa-headers-1">Map EcoTaxa Headers<a class="anchor" aria-label="anchor" href="#map-ecotaxa-headers-1"></a>
</h3>
<p>The metadata can be mapped with the headers in
<code><a href="../reference/ifcb_get_ecotaxa_example.html">ifcb_get_ecotaxa_example()</a></code> to produce metadata files
suitable for submitting images to EcoTaxa. The example below is
comprehensive and includes several feature fields. For a simpler
dataset, minimal fields can be retrieved using
<code>ifcb_get_ecotaxa_example(example = "minimal")</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get EcoTaxa metadata header names</span></span>
<span><span class="va">ecotaxa_headers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_ecotaxa_example.html">ifcb_get_ecotaxa_example</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">0</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Create a data frame with empty rows matching the length of data</span></span>
<span><span class="va">ecotaxa_headers</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Map metadata to populate the empty dataframe</span></span>
<span><span class="va">ecotaxa_metadata</span> <span class="op">&lt;-</span> <span class="va">ecotaxa_headers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Image fields</span></span>
<span>    img_file_name <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">image</span>,</span>
<span>    </span>
<span>    <span class="co"># Static information</span></span>
<span>    object_link <span class="op">=</span> <span class="st">"https://doi.org/10.17044/scilifelab.25883455"</span>,</span>
<span>    object_annotation_status <span class="op">=</span> <span class="st">"validated"</span>,</span>
<span>    acq_resolution_pixels_per_micron <span class="op">=</span> <span class="fl">3.4</span>,</span>
<span>    acq_instrument <span class="op">=</span> <span class="st">"IFCB"</span>,</span>
<span>    sample_source <span class="op">=</span> <span class="st">"flowthrough"</span>,</span>
<span>    </span>
<span>    <span class="co"># Software</span></span>
<span>    process_soft <span class="op">=</span> <span class="st">"MATLAB, R"</span>,</span>
<span>    process_soft_version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"R2022a, "</span>, <span class="va">version</span><span class="op">$</span><span class="va">version.string</span><span class="op">)</span>,</span>
<span>    process_library <span class="op">=</span> <span class="st">"ifcb-analysis"</span>,</span>
<span>    process_library_version <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    process_script <span class="op">=</span> <span class="st">"iRfcb"</span>,</span>
<span>    process_script_version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"iRfcb"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    process_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>,</span>
<span>    process_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%H%M%S"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Object-related fields</span></span>
<span>    object_id <span class="op">=</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">image</span><span class="op">)</span>,</span>
<span>    object_roi_number <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">roi</span>,</span>
<span>    object_lat <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">gpsLatitude</span>,</span>
<span>    object_lon <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">gpsLongitude</span>,</span>
<span>    object_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">date</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>,</span>
<span>    object_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">":"</span>, <span class="st">""</span>, <span class="va">metadata</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>,</span>
<span>    object_annotation_hierarchy <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">subfolder</span>,</span>
<span>    object_annotation_category <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">class_clean</span>,</span>
<span>    object_aphiaid <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">AphiaID</span>,</span>
<span>    object_annotation_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">analysis_date</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>,</span>
<span>    object_annotation_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">":"</span>, <span class="st">""</span>, <span class="va">metadata</span><span class="op">$</span><span class="va">analysis_time</span><span class="op">)</span>,</span>
<span>    object_annotation_person_name <span class="op">=</span> <span class="st">"John Doe"</span>,</span>
<span>    object_annotation_person_email <span class="op">=</span> <span class="st">"john.doe@email.com"</span>,</span>
<span>    </span>
<span>    <span class="co"># Depth fields</span></span>
<span>    object_depth_min <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    <span class="co"># Sampled at 4 m depth</span></span>
<span>    object_depth_max <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    <span class="co"># Sampled at 4 m depth</span></span>
<span>    </span>
<span>    <span class="co"># Sample fields</span></span>
<span>    sample_vessel <span class="op">=</span> <span class="st">"RV Svea"</span>,</span>
<span>    sample_id <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">sample</span>,</span>
<span>    sample_station <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    sample_cruise <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    </span>
<span>    <span class="co">### Features fields</span></span>
<span>    </span>
<span>    <span class="co"># PMT</span></span>
<span>    object_pmt_scattering <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    object_pmt_fluorescence <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    </span>
<span>    <span class="co"># Morphological metrics</span></span>
<span>    object_area <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Area</span>,</span>
<span>    object_biovolume <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Biovolume</span>,</span>
<span>    object_perimeter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Perimeter</span>,</span>
<span>    object_bounding_box_xwidth <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">BoundingBox_xwidth</span>,</span>
<span>    object_bounding_box_ywidth <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">BoundingBox_ywidth</span>,</span>
<span>    object_convex_area <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">ConvexArea</span>,</span>
<span>    object_convex_perimeter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">ConvexPerimeter</span>,</span>
<span>    object_feret_diameter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">FeretDiameter</span>,</span>
<span>    object_major_axis_length <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">MajorAxisLength</span>,</span>
<span>    object_minor_axis_length <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">MinorAxisLength</span>,</span>
<span>    object_orientation <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Orientation</span>,</span>
<span>    object_eccentricity <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Eccentricity</span>,</span>
<span>    object_equiv_diameter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">EquivDiameter</span>,</span>
<span>    object_extent <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Extent</span>,</span>
<span>    object_r_wcenter2total_powerratio <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">RWcenter2total_powerratio</span>,</span>
<span>    object_r_whalfpowerintegral <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">RWhalfpowerintegral</span>,</span>
<span>    </span>
<span>    <span class="co"># Miscellaneous fields</span></span>
<span>    object_solidity <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Solidity</span>,</span>
<span>    object_num_blobs <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">numBlobs</span>,</span>
<span>    object_h180 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">H180</span>,</span>
<span>    object_h90 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">H90</span>,</span>
<span>    object_hflip <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Hflip</span>,</span>
<span>    object_summed_area <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedArea</span>,</span>
<span>    object_summed_biovolume <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedBiovolume</span>,</span>
<span>    object_summed_convex_area <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedConvexArea</span>,</span>
<span>    object_summed_convex_perimeter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedConvexPerimeter</span>,</span>
<span>    object_summed_feret_diameter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedFeretDiameter</span>,</span>
<span>    object_summed_major_axis_length <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedMajorAxisLength</span>,</span>
<span>    object_summed_minor_axis_length <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedMinorAxisLength</span>,</span>
<span>    object_summed_perimeter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedPerimeter</span>,</span>
<span>    object_shapehist_kurtosis_norm_eq_d <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">shapehist_kurtosis_normEqD</span>,</span>
<span>    object_shapehist_mean_norm_eq_d <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">shapehist_mean_normEqD</span>,</span>
<span>    object_shapehist_median_norm_eq_d <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">shapehist_median_normEqD</span>,</span>
<span>    object_shapehist_mode_norm_eq_d <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">shapehist_mode_normEqD</span>,</span>
<span>    object_shapehist_skewness_norm_eq_d <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">shapehist_skewness_normEqD</span>,</span>
<span>    object_area_over_perimeter_squared <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Area_over_PerimeterSquared</span>,</span>
<span>    object_area_over_perimeter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Area_over_Perimeter</span>,</span>
<span>    object_h90_over_hflip <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">H90_over_Hflip</span>,</span>
<span>    object_h90_over_h180 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">H90_over_H180</span>,</span>
<span>    object_hflip_over_h180 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Hflip_over_H180</span>,</span>
<span>    object_summed_convex_perimeter_over_perimeter <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">summedConvexPerimeter_over_Perimeter</span>,</span>
<span>    object_rotated_bounding_box_solidity <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">rotated_BoundingBox_solidity</span>,</span>
<span>    object_rotated_area <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">RotatedArea</span>,</span>
<span>    object_rotated_bounding_box_xwidth <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">RotatedBoundingBox_xwidth</span>,</span>
<span>    object_rotated_bounding_box_ywidth <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">RotatedBoundingBox_ywidth</span>,</span>
<span>    </span>
<span>    <span class="co"># Texture-related fields</span></span>
<span>    object_texture_average_contrast <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">texture_average_contrast</span>,</span>
<span>    object_texture_average_gray_level <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">texture_average_gray_level</span>,</span>
<span>    object_texture_entropy <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">texture_entropy</span>,</span>
<span>    object_texture_smoothness <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">texture_smoothness</span>,</span>
<span>    object_texture_third_moment <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">texture_third_moment</span>,</span>
<span>    object_texture_uniformity <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">texture_uniformity</span>,</span>
<span>    </span>
<span>    <span class="co"># Moment invariants</span></span>
<span>    object_moment_invariant1 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">moment_invariant1</span>,</span>
<span>    object_moment_invariant2 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">moment_invariant2</span>,</span>
<span>    object_moment_invariant3 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">moment_invariant3</span>,</span>
<span>    object_moment_invariant4 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">moment_invariant4</span>,</span>
<span>    object_moment_invariant5 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">moment_invariant5</span>,</span>
<span>    object_moment_invariant6 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">moment_invariant6</span>,</span>
<span>    object_moment_invariant7 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">moment_invariant7</span>,</span>
<span>    </span>
<span>    <span class="co"># Ring fields</span></span>
<span>    object_ring01 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring01</span>,</span>
<span>    object_ring02 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring02</span>,</span>
<span>    object_ring03 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring03</span>,</span>
<span>    object_ring04 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring04</span>,</span>
<span>    object_ring05 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring05</span>,</span>
<span>    object_ring06 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring06</span>,</span>
<span>    object_ring07 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring07</span>,</span>
<span>    object_ring08 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring08</span>,</span>
<span>    object_ring09 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring09</span>,</span>
<span>    object_ring10 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring10</span>,</span>
<span>    object_ring11 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring11</span>,</span>
<span>    object_ring12 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring12</span>,</span>
<span>    object_ring13 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring13</span>,</span>
<span>    object_ring14 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring14</span>,</span>
<span>    object_ring15 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring15</span>,</span>
<span>    object_ring16 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring16</span>,</span>
<span>    object_ring17 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring17</span>,</span>
<span>    object_ring18 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring18</span>,</span>
<span>    object_ring19 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring19</span>,</span>
<span>    object_ring20 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring20</span>,</span>
<span>    object_ring21 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring21</span>,</span>
<span>    object_ring22 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring22</span>,</span>
<span>    object_ring23 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring23</span>,</span>
<span>    object_ring24 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring24</span>,</span>
<span>    object_ring25 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring25</span>,</span>
<span>    object_ring26 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring26</span>,</span>
<span>    object_ring27 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring27</span>,</span>
<span>    object_ring28 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring28</span>,</span>
<span>    object_ring29 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring29</span>,</span>
<span>    object_ring30 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring30</span>,</span>
<span>    object_ring31 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring31</span>,</span>
<span>    object_ring32 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring32</span>,</span>
<span>    object_ring33 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring33</span>,</span>
<span>    object_ring34 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring34</span>,</span>
<span>    object_ring35 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring35</span>,</span>
<span>    object_ring36 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring36</span>,</span>
<span>    object_ring37 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring37</span>,</span>
<span>    object_ring38 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring38</span>,</span>
<span>    object_ring39 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring39</span>,</span>
<span>    object_ring40 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring40</span>,</span>
<span>    object_ring41 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring41</span>,</span>
<span>    object_ring42 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring42</span>,</span>
<span>    object_ring43 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring43</span>,</span>
<span>    object_ring44 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring44</span>,</span>
<span>    object_ring45 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring45</span>,</span>
<span>    object_ring46 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring46</span>,</span>
<span>    object_ring47 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring47</span>,</span>
<span>    object_ring48 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring48</span>,</span>
<span>    object_ring49 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring49</span>,</span>
<span>    object_ring50 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Ring50</span>,</span>
<span>    </span>
<span>    <span class="co"># HOG fields</span></span>
<span>    object_hog01 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG01</span>,</span>
<span>    object_hog02 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG02</span>,</span>
<span>    object_hog03 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG03</span>,</span>
<span>    object_hog04 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG04</span>,</span>
<span>    object_hog05 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG05</span>,</span>
<span>    object_hog06 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG06</span>,</span>
<span>    object_hog07 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG07</span>,</span>
<span>    object_hog08 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG08</span>,</span>
<span>    object_hog09 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG09</span>,</span>
<span>    object_hog10 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG10</span>,</span>
<span>    object_hog11 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG11</span>,</span>
<span>    object_hog12 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG12</span>,</span>
<span>    object_hog13 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG13</span>,</span>
<span>    object_hog14 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG14</span>,</span>
<span>    object_hog15 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG15</span>,</span>
<span>    object_hog16 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG16</span>,</span>
<span>    object_hog17 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG17</span>,</span>
<span>    object_hog18 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG18</span>,</span>
<span>    object_hog19 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG19</span>,</span>
<span>    object_hog20 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG20</span>,</span>
<span>    object_hog21 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG21</span>,</span>
<span>    object_hog22 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG22</span>,</span>
<span>    object_hog23 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG23</span>,</span>
<span>    object_hog24 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG24</span>,</span>
<span>    object_hog25 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG25</span>,</span>
<span>    object_hog26 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG26</span>,</span>
<span>    object_hog27 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG27</span>,</span>
<span>    object_hog28 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG28</span>,</span>
<span>    object_hog29 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG29</span>,</span>
<span>    object_hog30 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG30</span>,</span>
<span>    object_hog31 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG31</span>,</span>
<span>    object_hog32 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG32</span>,</span>
<span>    object_hog33 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG33</span>,</span>
<span>    object_hog34 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG34</span>,</span>
<span>    object_hog35 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG35</span>,</span>
<span>    object_hog36 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG36</span>,</span>
<span>    object_hog37 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG37</span>,</span>
<span>    object_hog38 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG38</span>,</span>
<span>    object_hog39 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG39</span>,</span>
<span>    object_hog40 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG40</span>,</span>
<span>    object_hog41 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG41</span>,</span>
<span>    object_hog42 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG42</span>,</span>
<span>    object_hog43 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG43</span>,</span>
<span>    object_hog44 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG44</span>,</span>
<span>    object_hog45 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG45</span>,</span>
<span>    object_hog46 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG46</span>,</span>
<span>    object_hog47 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG47</span>,</span>
<span>    object_hog48 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG48</span>,</span>
<span>    object_hog49 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG49</span>,</span>
<span>    object_hog50 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG50</span>,</span>
<span>    object_hog51 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG51</span>,</span>
<span>    object_hog52 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG52</span>,</span>
<span>    object_hog53 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG53</span>,</span>
<span>    object_hog54 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG54</span>,</span>
<span>    object_hog55 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG55</span>,</span>
<span>    object_hog56 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG56</span>,</span>
<span>    object_hog57 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG57</span>,</span>
<span>    object_hog58 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG58</span>,</span>
<span>    object_hog59 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG59</span>,</span>
<span>    object_hog60 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG60</span>,</span>
<span>    object_hog61 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG61</span>,</span>
<span>    object_hog62 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG62</span>,</span>
<span>    object_hog63 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG63</span>,</span>
<span>    object_hog64 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG64</span>,</span>
<span>    object_hog65 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG65</span>,</span>
<span>    object_hog66 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG66</span>,</span>
<span>    object_hog67 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG67</span>,</span>
<span>    object_hog68 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG68</span>,</span>
<span>    object_hog69 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG69</span>,</span>
<span>    object_hog70 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG70</span>,</span>
<span>    object_hog71 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG71</span>,</span>
<span>    object_hog72 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG72</span>,</span>
<span>    object_hog73 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG73</span>,</span>
<span>    object_hog74 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG74</span>,</span>
<span>    object_hog75 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG75</span>,</span>
<span>    object_hog76 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG76</span>,</span>
<span>    object_hog77 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG77</span>,</span>
<span>    object_hog78 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG78</span>,</span>
<span>    object_hog79 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG79</span>,</span>
<span>    object_hog80 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG80</span>,</span>
<span>    object_hog81 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">HOG81</span>,</span>
<span>    </span>
<span>    <span class="co"># Wedge fields</span></span>
<span>    object_wedge01 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge01</span>,</span>
<span>    object_wedge02 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge02</span>,</span>
<span>    object_wedge03 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge03</span>,</span>
<span>    object_wedge04 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge04</span>,</span>
<span>    object_wedge05 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge05</span>,</span>
<span>    object_wedge06 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge06</span>,</span>
<span>    object_wedge07 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge07</span>,</span>
<span>    object_wedge08 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge08</span>,</span>
<span>    object_wedge09 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge09</span>,</span>
<span>    object_wedge10 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge10</span>,</span>
<span>    object_wedge11 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge11</span>,</span>
<span>    object_wedge12 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge12</span>,</span>
<span>    object_wedge13 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge13</span>,</span>
<span>    object_wedge14 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge14</span>,</span>
<span>    object_wedge15 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge15</span>,</span>
<span>    object_wedge16 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge16</span>,</span>
<span>    object_wedge17 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge17</span>,</span>
<span>    object_wedge18 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge18</span>,</span>
<span>    object_wedge19 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge19</span>,</span>
<span>    object_wedge20 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge20</span>,</span>
<span>    object_wedge21 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge21</span>,</span>
<span>    object_wedge22 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge22</span>,</span>
<span>    object_wedge23 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge23</span>,</span>
<span>    object_wedge24 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge24</span>,</span>
<span>    object_wedge25 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge25</span>,</span>
<span>    object_wedge26 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge26</span>,</span>
<span>    object_wedge27 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge27</span>,</span>
<span>    object_wedge28 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge28</span>,</span>
<span>    object_wedge29 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge29</span>,</span>
<span>    object_wedge30 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge30</span>,</span>
<span>    object_wedge31 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge31</span>,</span>
<span>    object_wedge32 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge32</span>,</span>
<span>    object_wedge33 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge33</span>,</span>
<span>    object_wedge34 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge34</span>,</span>
<span>    object_wedge35 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge35</span>,</span>
<span>    object_wedge36 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge36</span>,</span>
<span>    object_wedge37 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge37</span>,</span>
<span>    object_wedge38 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge38</span>,</span>
<span>    object_wedge39 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge39</span>,</span>
<span>    object_wedge40 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge40</span>,</span>
<span>    object_wedge41 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge41</span>,</span>
<span>    object_wedge42 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge42</span>,</span>
<span>    object_wedge43 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge43</span>,</span>
<span>    object_wedge44 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge44</span>,</span>
<span>    object_wedge45 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge45</span>,</span>
<span>    object_wedge46 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge46</span>,</span>
<span>    object_wedge47 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge47</span>,</span>
<span>    object_wedge48 <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">Wedge48</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-ecotaxa-tsv-files">Generate EcoTaxa TSV Files<a class="anchor" aria-label="anchor" href="#generate-ecotaxa-tsv-files"></a>
</h3>
<p>This section demonstrates how to generate <code>.tsv</code> files
containing metadata for each class subfolder. These files are essential
for uploading data into EcoTaxa. Each <code>.tsv</code> file is written
to its respective class subfolder and includes the relevant metadata for
that class.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Loop .tsv creation for each class</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ecotaxa_metadata</span><span class="op">$</span><span class="va">object_annotation_hierarchy</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Define path to subfolder</span></span>
<span>  <span class="va">subfolder_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>    <span class="st">"data/extracted_images"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ecotaxa_metadata</span><span class="op">$</span><span class="va">object_annotation_hierarchy</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Filter metadata for each class</span></span>
<span>  <span class="va">ecotaxa_metadata_ix</span> <span class="op">&lt;-</span> <span class="va">ecotaxa_metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">object_annotation_hierarchy</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ecotaxa_metadata</span><span class="op">$</span><span class="va">object_annotation_hierarchy</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      object_annotation_hierarchy <span class="op">=</span> <span class="fu">iRfcb</span><span class="fu">:::</span><span class="fu">truncate_folder_name</span><span class="op">(</span><span class="va">object_annotation_hierarchy</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add data format codes (text[t], float[f] etc.)</span></span>
<span>  <span class="va">ecotaxa_metadata_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/ifcb_get_ecotaxa_example.html">ifcb_get_ecotaxa_example</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">ecotaxa_metadata_ix</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Write one metadata file per class subfolder</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">ecotaxa_metadata_ix</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">subfolder_path</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>              <span class="st">"ecotaxa_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span></span>
<span>                <span class="fu">iRfcb</span><span class="fu">:::</span><span class="fu">truncate_folder_name</span><span class="op">(</span><span class="va">ecotaxa_metadata</span><span class="op">$</span><span class="va">object_annotation_hierarchy</span><span class="op">)</span></span>
<span>              <span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".tsv"</span></span>
<span>            <span class="op">)</span><span class="op">)</span>,</span>
<span>            na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-a-zip-archive-for-ecotaxa">Creating a Zip Archive for EcoTaxa<a class="anchor" aria-label="anchor" href="#creating-a-zip-archive-for-ecotaxa"></a>
</h3>
<p>Prepare the PNG directory for publication by creating a zip archive,
ready for upload through the EcoTaxa web interface. Note that the web
interface has a maximum file size limit of 500 MB. To accommodate this
limitation, the zip archive can be split into multiple files by setting
<code>split_zip</code> to <code>TRUE</code> and specifying the
<code>max_size</code> parameter in megabytes.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create zip-archive</span></span>
<span><span class="fu"><a href="../reference/ifcb_zip_pngs.html">ifcb_zip_pngs</a></span><span class="op">(</span></span>
<span>  png_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>  zip_filename <span class="op">=</span> <span class="st">"data/zip/iRfcb_ecotaxa.zip"</span>,</span>
<span>  readme_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata/README-template.md"</span>, package <span class="op">=</span> <span class="st">"iRfcb"</span><span class="op">)</span>,</span>
<span>  <span class="co"># Template icluded in `iRfcb`</span></span>
<span>  email_address <span class="op">=</span> <span class="st">"tutorial@test.com"</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"1.1"</span>,</span>
<span>  include_txt <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="co"># To include the metadata text-files in the archive</span></span>
<span>  split_zip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  max_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  print_progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Creating README file...</span></span>
<span><span class="co">## Creating MANIFEST.txt...</span></span>
<span><span class="co">## Creating zip archive...</span></span>
<span><span class="co">## Zip archive created successfully: /home/runner/work/iRfcb/iRfcb/vignettes/data/zip/iRfcb_ecotaxa.zip</span></span></code></pre>
<p>This concludes this tutorial for the <code>iRfcb</code> package. For
more detailed information, refer to the package documentation or the
other <a href="https://europeanifcbgroup.github.io/iRfcb/articles/">tutorials</a>.
See how data pipelines can be constructed using <code>iRfcb</code> in
the following <a href="https://github.com/nodc-sweden/ifcb-data-pipeline" class="external-link">Example
Project</a>. Happy analyzing!</p>
</div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<pre><code><span><span class="co">## To cite package 'iRfcb' in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Anders Torstensson (2025). iRfcb: Tools for Managing Imaging</span></span>
<span><span class="co">##   FlowCytobot (IFCB) Data. R package version 0.5.2.</span></span>
<span><span class="co">##   https://CRAN.R-project.org/package=iRfcb</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Manual{,</span></span>
<span><span class="co">##     title = {iRfcb: Tools for Managing Imaging FlowCytobot (IFCB) Data},</span></span>
<span><span class="co">##     author = {Anders Torstensson},</span></span>
<span><span class="co">##     year = {2025},</span></span>
<span><span class="co">##     note = {R package version 0.5.2},</span></span>
<span><span class="co">##     url = {https://CRAN.R-project.org/package=iRfcb},</span></span>
<span><span class="co">##   }</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Sosik, H. M. and Olson, R. J. (2007) Automated taxonomic
classification of phytoplankton sampled with imaging-in-flow cytometry.
Limnol. Oceanogr: Methods 5, 204–216.</li>
<li>Torstensson, A., Skjevik, A-T., Mohlin, M., Karlberg, M. and
Karlson, B. (2024). SMHI IFCB Plankton Image Reference Library.
SciLifeLab. Dataset. <a href="https://doi.org/10.17044/scilifelab.25883455.v3" class="external-link uri">https://doi.org/10.17044/scilifelab.25883455.v3</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anders Torstensson, DTO-BioFlow, SBDI.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

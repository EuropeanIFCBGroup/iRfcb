# I ‘R’ FlowCytobot (iRfcb): Tools for Managing Imaging FlowCytobot (IFCB) Data

[![R-CMD-check](https://github.com/EuropeanIFCBGroup/iRfcb/actions/workflows/r-cmd-check.yml/badge.svg?event=push)](https://github.com/EuropeanIFCBGroup/iRfcb/actions/workflows/r-cmd-check.yml)
[![CRAN
status](https://www.r-pkg.org/badges/version/iRfcb)](https://CRAN.R-project.org/package=iRfcb)
[![CRAN
checks](https://badges.cranchecks.info/worst/iRfcb.svg)](https://cran.r-project.org/web/checks/check_results_iRfcb.html)
[![Codecov test
coverage](https://codecov.io/gh/EuropeanIFCBGroup/iRfcb/branch/main/graph/badge.svg)](https://app.codecov.io/gh/EuropeanIFCBGroup/iRfcb?branch=main)

## Overview

The `iRfcb` R package offers a suite of tools for managing and
performing quality control on plankton data generated by the [Imaging
FlowCytobot (IFCB)](https://mclanelabs.com/imaging-flowcytobot/). It
streamlines the processing and analysis of IFCB data, facilitating the
preparation of IFCB data and images for publication (e.g. in
[GBIF](https://www.gbif.org/), [OBIS](https://obis.org/),
[EMODNet](https://emodnet.ec.europa.eu/en),
[SHARK](https://shark.smhi.se/) or
[EcoTaxa](https://ecotaxa.obs-vlfr.fr)). It is especially useful for
researchers using, or partly using, the MATLAB
[ifcb-analysis](https://github.com/hsosik/ifcb-analysis) package.

### Functional Highlights

- **Data Management**: Functions for reading raw and processed IFCB
  files, counting and summarizing annotated or classified image data,
  and accessing, correcting, and merging manually annotated datasets.
- **Quality Control**: Tools for geospatial quality control of IFCB data
  and analysis of [Particle Size
  Distribution](https://github.com/kudelalab/PSD).
- **Image Extraction**: Tools to extract and prepare images for
  publication.
- **Taxonomical Data**: Tools for handling and analyzing taxonomic data
  and calculating biomass concentration from image data.

## Installation

You can install `iRfcb` from CRAN using:

``` r
install.packages("iRfcb")
```

### Development version

To access a feature from the development version of `iRfcb`, install the
latest development version from GitHub using the `remotes` package:

``` r
# install.packages("remotes")
remotes::install_github("EuropeanIFCBGroup/iRfcb")
```

## Documentation and Tutorials

### Reference

For a detailed overview of all available `iRfcb` functions, please visit
the reference section:

- [Function
  Reference](https://europeanifcbgroup.github.io/iRfcb/reference/index.html)

### Tutorials

Explore the key features and capabilities of `iRfcb` through the
tutorials:

- [iRfcb
  Introduction](https://europeanifcbgroup.github.io/iRfcb/articles/a-general-tutorial.html)
- [Quality Control of IFCB
  Data](https://europeanifcbgroup.github.io/iRfcb/articles/qc-tutorial.html)
- [Handling MATLAB
  Results](https://europeanifcbgroup.github.io/iRfcb/articles/matlab-tutorial.html)
- [Creating a DwC-A from IFCB
  Data](https://europeanifcbgroup.github.io/iRfcb/articles/dwca-tutorial.html)
- [Sharing Annotated IFCB
  Images](https://europeanifcbgroup.github.io/iRfcb/articles/image-export-tutorial.html)
- [Prepare IFCB Images for
  EcoTaxa](https://europeanifcbgroup.github.io/iRfcb/articles/ecotaxa-tutorial.html)
- [WHOI-Plankton Data
  Integration](https://europeanifcbgroup.github.io/iRfcb/articles/whoi-plankton-data-integration.html)

### Example Usage

`iRfcb` is designed for integration into IFCB data processing pipelines.
For an example, see its implementation in the following project:

- [Example Data
  Pipelines](https://github.com/nodc-sweden/ifcb-data-pipeline)

## Python Dependency

Some functions in `iRfcb` require Python, and you will be notified when
you call one of these functions. You can download Python from the
official website:
[python.org/downloads](https://www.python.org/downloads/). For details
on what function that require Python, please visit the project’s
[Function
Reference](https://europeanifcbgroup.github.io/iRfcb/reference/index.html#python-dependency-python-powered-python-powered-w-x-png-).

A Python virtual environment (venv) can be created using the
[`ifcb_py_install()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_py_install.md)
function before calling the function that require Python.

The `iRfcb` package can also be configured to automatically activate an
installed Python venv upon loading by setting an environment variable.
This feature is especially useful for users who regularly interact with
Python dependencies within the `iRfcb` package.

### USE_IRFCB_PYTHON

- **Description**: The `USE_IRFCB_PYTHON` environment variable controls
  whether the package automatically activates a pre-installed Python
  venv named `iRfcb` when the package is loaded.
- **Default**: By default, this environment variable is not set. This
  means that the Python environment will not be loaded automatically,
  and the user must call the
  [`ifcb_py_install()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_py_install.md)
  functions manually before using a Python feature.
- **Usage**: To enable automatic setup of the Python environment when
  `iRfcb` is loaded, set `USE_IRFCB_PYTHON` to `"TRUE"`. Ensure that a
  venv named `iRfcb` is installed (e.g. through
  [`ifcb_py_install()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_py_install.md))
  in
  [`reticulate::virtualenv_root()`](https://rstudio.github.io/reticulate/reference/virtualenv-tools.html)
  and available via
  [`reticulate::virtualenv_list()`](https://rstudio.github.io/reticulate/reference/virtualenv-tools.html).

#### How to Set the `USE_IRFCB_PYTHON` Variable

You can set the `USE_IRFCB_PYTHON` variable in your R session or make it
persistent across sessions:

1.  **Temporary for the session**: You can set the variable in your R
    session before loading `iRfcb` using the following command:

    ``` r
    Sys.setenv(USE_IRFCB_PYTHON = "TRUE")
    ```

2.  **Permanent across sessions**: To ensure this setting persists
    across R sessions, add it to your `.Renviron` file in your R home
    directory. You can easily edit the file using the following command:

    ``` r
    usethis::edit_r_environ("user")
    ```

    Then, add the following line to the file:

    ``` text
    USE_IRFCB_PYTHON=TRUE
    ```

    This will automatically set the environment variable each time you
    start an R session.

## Getting help

If you encounter a bug or need an IFCB feature that’s missing, please
report it on [GitHub](https://github.com/EuropeanIFCBGroup/iRfcb/issues)
with a minimal reproducible example.

## Repository

For more details and the latest updates, visit the [GitHub
repository](https://github.com/EuropeanIFCBGroup/iRfcb).

## License

This package is licensed under the MIT License.

# Package index

## Main functions

### Core functions

Core functions for processing and analyzing IFCB data.

- [`ifcb_convert_filenames()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_convert_filenames.md)
  : Convert IFCB Filenames to Timestamps
- [`ifcb_count_mat_annotations()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_count_mat_annotations.md)
  : Count IFCB Annotations from .mat Files
- [`ifcb_create_manifest()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_create_manifest.md)
  : Create a MANIFEST.txt File
- [`ifcb_download_dashboard_data()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_download_dashboard_data.md)
  : Download IFCB data files from an IFCB Dashboard
- [`ifcb_download_dashboard_metadata()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_download_dashboard_metadata.md)
  : Download metadata from the IFCB Dashboard API
- [`ifcb_download_test_data()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_download_test_data.md)
  : Download Test IFCB Data
- [`ifcb_download_whoi_plankton()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_download_whoi_plankton.md)
  : Download and Extract WHOI-Plankton Data
- [`ifcb_extract_annotated_images()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_extract_annotated_images.md)
  : Extract Annotated Images from IFCB Data
- [`ifcb_extract_biovolumes()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_extract_biovolumes.md)
  : Extract Biovolumes from IFCB Data and Compute Carbon Content
- [`ifcb_extract_classified_images()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_extract_classified_images.md)
  : Extract Taxa Images from MATLAB Classified Sample
- [`ifcb_extract_pngs()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_extract_pngs.md)
  : Extract Images from IFCB ROI File
- [`ifcb_get_ecotaxa_example()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_get_ecotaxa_example.md)
  : Get EcoTaxa Column Names
- [`ifcb_get_ferrybox_data()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_get_ferrybox_data.md)
  : Retrieve Ferrybox Data for Specified Timestamps
- [`ifcb_get_mat_names()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_get_mat_names.md)
  : Get Variable Names from a MAT File
- [`ifcb_get_mat_variable()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_get_mat_variable.md)
  : Get Classes from a MAT File
- [`ifcb_get_runtime()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_get_runtime.md)
  : Read IFCB Header File and Extract Runtime Information
- [`ifcb_get_shark_colnames()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_get_shark_colnames.md)
  : Get Shark Column Names
- [`ifcb_get_shark_example()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_get_shark_example.md)
  : Get Shark Column Example
- [`ifcb_get_trophic_type()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_get_trophic_type.md)
  : Get Trophic Type for a List of Plankton Taxa
- [`ifcb_is_diatom()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_is_diatom.md)
  : Identify Diatoms in Taxa List
- [`ifcb_is_in_basin()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_is_in_basin.md)
  : Check if Points are in a Specific Sea Basin
- [`ifcb_is_near_land()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_is_near_land.md)
  : Determine if Positions are Near Land
- [`ifcb_list_dashboard_bins()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_list_dashboard_bins.md)
  : Download bin list from the IFCB Dashboard API
- [`ifcb_match_taxa_names()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_match_taxa_names.md)
  **\[superseded\]** : Retrieve WoRMS Records with Retry Mechanism
- [`ifcb_psd_plot()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_psd_plot.md)
  : Generate PSD Plot for a Given Sample
- [`ifcb_read_features()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_read_features.md)
  : Read Feature Files from a Specified Folder or File Paths
- [`ifcb_read_hdr_data()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_read_hdr_data.md)
  : Reads HDR Data from IFCB HDR Files
- [`ifcb_read_summary()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_read_summary.md)
  : Read and Summarize Classified IFCB Data
- [`ifcb_run_image_gallery()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_run_image_gallery.md)
  : Run IFCB Image Gallery
- [`ifcb_summarize_biovolumes()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_summarize_biovolumes.md)
  : Summarize Biovolumes and Carbon Content from IFCB Data
- [`ifcb_summarize_class_counts()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_summarize_class_counts.md)
  : Count Cells from TreeBagger Classifier Output
- [`ifcb_summarize_png_counts()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_summarize_png_counts.md)
  : Summarize Image Counts by Class and Sample
- [`ifcb_summarize_png_metadata()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_summarize_png_metadata.md)
  : Summarize PNG Image Metadata
- [`ifcb_volume_analyzed()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_volume_analyzed.md)
  : Estimate Volume Analyzed from IFCB Header File
- [`ifcb_volume_analyzed_from_adc()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_volume_analyzed_from_adc.md)
  : Estimate Volume Analyzed from IFCB ADC File
- [`ifcb_which_basin()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_which_basin.md)
  : Determine if Points are in a Specified Sea Basin
- [`ifcb_zip_matlab()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_zip_matlab.md)
  : Create a Zip Archive of Manual MATLAB Files
- [`ifcb_zip_pngs()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_zip_pngs.md)
  : Zip PNG Folders

### Python dependency ![Python Powered](../python-powered-w-70x28.png)

These functions depend on a working Python installation. For more
information, see the
[README](https://europeanifcbgroup.github.io/iRfcb/#python-dependency).

- [`ifcb_adjust_classes()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_adjust_classes.md)
  : Adjust Classifications in Manual Annotations

- [`ifcb_annotate_batch()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_annotate_batch.md)
  : Annotate IFCB Images with Specified Class

- [`ifcb_annotate_samples()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_annotate_samples.md)
  : Create Manual Classification MAT Files from PNG Subfolders

- [`ifcb_correct_annotation()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_correct_annotation.md)
  : Correct Annotations in MATLAB Classlist Files

- [`ifcb_create_class2use()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_create_class2use.md)
  :

  Create a class2use `.mat` File

- [`ifcb_create_manual_file()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_create_manual_file.md)
  : Create a Manual Classification MAT File

- [`ifcb_merge_manual()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_merge_manual.md)
  : Merge IFCB Manual Classification Data

- [`ifcb_prepare_whoi_plankton()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_prepare_whoi_plankton.md)
  : Download and Prepare WHOI-Plankton Data

- [`ifcb_psd()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_psd.md)
  : Plot and Save IFCB PSD Data

- [`ifcb_py_install()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_py_install.md)
  : Install iRfcb Python Environment

- [`ifcb_replace_mat_values()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_replace_mat_values.md)
  : Replace Values in MATLAB Classlist

- [`ifcb_read_mat()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_read_mat.md)
  : Read a MATLAB .mat File in R

## Helper functions

- [`create_package_manifest()`](https://europeanifcbgroup.github.io/iRfcb/reference/create_package_manifest.md)
  : Function to Create MANIFEST.txt
- [`process_ifcb_string()`](https://europeanifcbgroup.github.io/iRfcb/reference/process_ifcb_string.md)
  : Process IFCB String
- [`read_hdr_file()`](https://europeanifcbgroup.github.io/iRfcb/reference/read_hdr_file.md)
  : Function to Read Individual Files and Extract Relevant Lines
- [`split_large_zip()`](https://europeanifcbgroup.github.io/iRfcb/reference/split_large_zip.md)
  : Split Large Zip File into Smaller Parts
- [`summarize_TBclass()`](https://europeanifcbgroup.github.io/iRfcb/reference/summarize_TBclass.md)
  : Summarize TreeBagger Classifier Results
- [`vol2C_lgdiatom()`](https://europeanifcbgroup.github.io/iRfcb/reference/vol2C_lgdiatom.md)
  : Convert Biovolume to Carbon for Large Diatoms
- [`vol2C_nondiatom()`](https://europeanifcbgroup.github.io/iRfcb/reference/vol2C_nondiatom.md)
  : Convert Biovolume to Carbon for Non-Diatom Protists

## Deprecated functions

- [`ifcb_create_empty_manual_file()`](https://europeanifcbgroup.github.io/iRfcb/reference/ifcb_create_empty_manual_file.md)
  **\[deprecated\]** : Create an Empty Manual Classification MAT File
- [`retrieve_worms_records()`](https://europeanifcbgroup.github.io/iRfcb/reference/retrieve_worms_records.md)
  **\[deprecated\]** : Retrieve WoRMS Records with Retry Mechanism

# Articles

### All vignettes

- [Creating a DwC-A from IFCB
  Data](https://europeanifcbgroup.github.io/iRfcb/articles/dwca-tutorial.md):
- [Prepare IFCB Images for
  EcoTaxa](https://europeanifcbgroup.github.io/iRfcb/articles/ecotaxa-tutorial.md):
- [Sharing Annotated IFCB
  Images](https://europeanifcbgroup.github.io/iRfcb/articles/image-export-tutorial.md):
- [iRfcb
  Introduction](https://europeanifcbgroup.github.io/iRfcb/articles/introduction.md):
- [Handling MATLAB
  Results](https://europeanifcbgroup.github.io/iRfcb/articles/matlab-tutorial.md):
- [Metadata
  template](https://europeanifcbgroup.github.io/iRfcb/articles/metadata-template.md):
- [Quality Control of IFCB
  Data](https://europeanifcbgroup.github.io/iRfcb/articles/qc-tutorial.md):
- [WHOI-Plankton Data
  Integration](https://europeanifcbgroup.github.io/iRfcb/articles/whoi-plankton-data-integration.md):

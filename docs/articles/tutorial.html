<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial • iRfcb</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial">
<meta property="og:description" content="iRfcb">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iRfcb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial.html">Tutorial</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial</h1>
            
      
      
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the package from GitHub using the
<code>devtools</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"EuropeanIFCBGroup/iRfcb"</span>,</span>
<span>                         dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Some functions in <code>iRfcb</code> require <code>Python</code> to
be installed (see in the sections below). You can download
<code>Python</code> from the official website: <a href="https://www.python.org/downloads/" class="external-link">python.org/downloads</a>.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>Load the <code>iRfcb</code> library:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">iRfcb</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-sample-data">Download Sample Data<a class="anchor" aria-label="anchor" href="#download-sample-data"></a>
</h2>
<p>To get started, download sample data from the <a href="https://doi.org/10.17044/scilifelab.25883455" class="external-link">SMHI IFCB Plankton
image reference library</a> with the following function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download and extract test data in the data folder</span></span>
<span><span class="fu"><a href="../reference/ifcb_download_test_data.html">ifcb_download_test_data</a></span><span class="op">(</span>dest_dir <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Download and extraction complete.</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="run-qcqa-checks">Run QC/QA Checks<a class="anchor" aria-label="anchor" href="#run-qcqa-checks"></a>
</h2>
<div class="section level3">
<h3 id="run-particle-size-distribution-qc">Run Particle Size Distribution QC<a class="anchor" aria-label="anchor" href="#run-particle-size-distribution-qc"></a>
</h3>
<p>IFCB data can be quality controlled by analyzing the particle size
distribution (PSD) (Hayashi et al. in prep). <code>iRfcb</code> uses the
code available at <a href="https://github.com/kudelalab/PSD" class="external-link">https://github.com/kudelalab/PSD</a>.
Before running the PSD quality check, ensure the necessary Python
environment is set up and activated:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print output from PSD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">psd</span><span class="op">$</span><span class="va">fits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">##   sample            a     k   R.2 max_ESD_diff capture_percent bead_run humidity</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D20230314T… 7.56<span style="color: #949494;">e</span>10 -<span style="color: #BB0000;">6.22</span> 0.963            1           0.955        0     16.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D20230314T… 2.44<span style="color: #949494;">e</span>11 -<span style="color: #BB0000;">6.75</span> 0.955            1           0.944        0     16.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D20230314T… 6.14<span style="color: #949494;">e</span>11 -<span style="color: #BB0000;">7.10</span> 0.961            1           0.953        0     16.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D20230315T… 2.22<span style="color: #949494;">e</span> 9 -<span style="color: #BB0000;">4.84</span> 0.972            0           0.978        0     16.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D20230315T… 2.38<span style="color: #949494;">e</span> 9 -<span style="color: #BB0000;">4.90</span> 0.974            1           0.983        0     16.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> D20230315T… 4.17<span style="color: #949494;">e</span> 8 -<span style="color: #BB0000;">4.18</span> 0.973            1           0.979        0     16.2</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">psd</span><span class="op">$</span><span class="va">flags</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   sample           flag         </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D20230915T091133 High Humidity</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D20230915T093804 High Humidity</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D20230915T100436 High Humidity</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D20230915T103107 High Humidity</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D20230915T110921 High Humidity</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> D20230915T113552 High Humidity</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot PSD of the first sample</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_psd_plot.html">ifcb_psd_plot</a></span><span class="op">(</span>sample_name <span class="op">=</span> <span class="va">psd</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">sample</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                      data <span class="op">=</span> <span class="va">psd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>                      fits <span class="op">=</span> <span class="va">psd</span><span class="op">$</span><span class="va">fits</span>,</span>
<span>                      start_fit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="check-if-ifcb-is-near-land">Check if IFCB is Near Land<a class="anchor" aria-label="anchor" href="#check-if-ifcb-is-near-land"></a>
</h3>
<p>To determine if the Imaging FlowCytobot (IFCB) is near land (i.e. in
harbor), examine the position data in the .hdr files (or from other
vectors of latitudes and longitudes):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read HDR data and extract GPS position (when available)</span></span>
<span><span class="va">gps_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_hdr_data.html">ifcb_read_hdr_data</a></span><span class="op">(</span><span class="st">"data/data/"</span>,</span>
<span>                               gps_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Found 91 .hdr files.</span></span>
<span><span class="co">## Processing completed.</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create new column with the results</span></span>
<span><span class="va">gps_data</span><span class="op">$</span><span class="va">near_land</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_is_near_land.html">ifcb_is_near_land</a></span><span class="op">(</span><span class="va">gps_data</span><span class="op">$</span><span class="va">gpsLatitude</span>,</span>
<span>                                        <span class="va">gps_data</span><span class="op">$</span><span class="va">gpsLongitude</span>,</span>
<span>                                        distance <span class="op">=</span> <span class="fl">100</span>, <span class="co"># 100 meters from shore</span></span>
<span>                                        shape <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co"># Using the default NE 1:10m Land Polygon</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gps_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     sample gpsLatitude gpsLongitude           timestamp</span></span>
<span><span class="co">## 1 D20220522T000439_IFCB134          NA           NA 2022-05-22 00:04:39</span></span>
<span><span class="co">## 2 D20220522T003051_IFCB134          NA           NA 2022-05-22 00:30:51</span></span>
<span><span class="co">## 3 D20220522T005703_IFCB134          NA           NA 2022-05-22 00:57:03</span></span>
<span><span class="co">## 4 D20220522T014928_IFCB134          NA           NA 2022-05-22 01:49:28</span></span>
<span><span class="co">## 5 D20220522T063741_IFCB134          NA           NA 2022-05-22 06:37:41</span></span>
<span><span class="co">## 6 D20220522T073005_IFCB134          NA           NA 2022-05-22 07:30:05</span></span>
<span><span class="co">##         date year month day     time ifcb_number near_land</span></span>
<span><span class="co">## 1 2022-05-22 2022     5  22 00:04:39     IFCB134        NA</span></span>
<span><span class="co">## 2 2022-05-22 2022     5  22 00:30:51     IFCB134        NA</span></span>
<span><span class="co">## 3 2022-05-22 2022     5  22 00:57:03     IFCB134        NA</span></span>
<span><span class="co">## 4 2022-05-22 2022     5  22 01:49:28     IFCB134        NA</span></span>
<span><span class="co">## 5 2022-05-22 2022     5  22 06:37:41     IFCB134        NA</span></span>
<span><span class="co">## 6 2022-05-22 2022     5  22 07:30:05     IFCB134        NA</span></span></code></pre>
<p>For more accurate determination, a detailed coastline .shp file may
be required (e.g. the <a href="https://www.eea.europa.eu/data-and-maps/data/eea-coastline-for-analysis-2/gis-data/eea-coastline-polygon" class="external-link">EEA
Coastline Polygon</a>). Refer to the help pages of
<code>ifcb_is_near_land</code> for further information.</p>
</div>
<div class="section level3">
<h3 id="check-which-sub-basin-an-ifcb-sample-is-from">Check which sub-basin an IFCB sample is from<a class="anchor" aria-label="anchor" href="#check-which-sub-basin-an-ifcb-sample-is-from"></a>
</h3>
<p>To identify the specific sub-basin of the Baltic Sea (or using a
custom shape-file) from which an Imaging FlowCytobot (IFCB) sample was
collected, analyze the position data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define example latitude and longitude vectors</span></span>
<span><span class="va">latitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55.337</span>, <span class="fl">54.729</span>, <span class="fl">56.311</span>, <span class="fl">57.975</span><span class="op">)</span></span>
<span><span class="va">longitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.674</span>, <span class="fl">14.643</span>, <span class="fl">12.237</span>, <span class="fl">10.637</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check in which Baltic sea basin the points are in</span></span>
<span><span class="va">points_in_the_baltic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_which_basin.html">ifcb_which_basin</a></span><span class="op">(</span><span class="va">latitudes</span>, </span>
<span>                                         <span class="va">longitudes</span>, </span>
<span>                                         shape_file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">points_in_the_baltic</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "13 - Arkona Basin"   "12 - Bornholm Basin" "16 - Kattegat"      </span></span>
<span><span class="co">## [4] "17 - Skagerrak"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the points and the basins</span></span>
<span><span class="fu"><a href="../reference/ifcb_which_basin.html">ifcb_which_basin</a></span><span class="op">(</span><span class="va">latitudes</span>, </span>
<span>                 <span class="va">longitudes</span>, </span>
<span>                 plot <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 shape_file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-7-1.png" width="700">
This function reads a pre-packaged shapefile of the Baltic Sea,
Kattegat, and Skagerrak basins from the ‘iRfcb’ package by default, or a
user-supplied shapefile if provided. The shapefiles provided in ‘iRfcb’
originate from <a href="https://sharkweb.smhi.se/hamta-data/" class="external-link">SHARK</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="annotated-files">Annotated Files<a class="anchor" aria-label="anchor" href="#annotated-files"></a>
</h2>
<div class="section level3">
<h3 id="count-and-summarize-annotated-image-data">Count and Summarize Annotated Image Data<a class="anchor" aria-label="anchor" href="#count-and-summarize-annotated-image-data"></a>
</h3>
<div class="section level4">
<h4 id="png-directory">PNG Directory<a class="anchor" aria-label="anchor" href="#png-directory"></a>
</h4>
<p>Summarize counts of annotated images at the sample and class levels.
The ‘hdr_folder’ can be included to add GPS positions to the sample data
frame:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarise counts on sample level</span></span>
<span><span class="va">png_per_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_data.html">ifcb_summarize_png_data</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/png"</span>,</span>
<span>                                          hdr_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                                          sum_level <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">png_per_sample</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   sample, ifcb_number [3]</span></span></span>
<span><span class="co">##   sample    ifcb_number class_name n_images roi_numbers gpsLatitude gpsLongitude</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D2022052… IFCB134     Ciliates          1 5                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D2022052… IFCB134     Mesodiniu…        4 2, 6, 7, 8           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D2022052… IFCB134     Strombidi…        1 3                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D2022052… IFCB134     Mesodiniu…        2 2, 3                 <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D2022052… IFCB134     Ciliates          1 2                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> D2022052… IFCB134     Strombidi…        1 5                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 6 more variables: timestamp &lt;dttm&gt;, date &lt;date&gt;, year &lt;dbl&gt;, month &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   day &lt;int&gt;, time &lt;chr&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarise counts on class level</span></span>
<span><span class="va">png_per_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_data.html">ifcb_summarize_png_data</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/png"</span>,</span>
<span>                                         sum_level <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">png_per_class</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   class_name                  n_images</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Akashiwo_sanguinea                 1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Alexandrium_pseudogonyaulax        7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Amphidnium_like                    2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Apedinella_radians                 8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Centrales                          8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Cerataulina_pelagica              97</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="matlab-files">MATLAB Files<a class="anchor" aria-label="anchor" href="#matlab-files"></a>
</h4>
<p>Count the annotations in the MATLAB files, similar to
<code>ifcb_summarize_png_data</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize counts from MATLAB files</span></span>
<span><span class="va">mat_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_count_mat_annotations.html">ifcb_count_mat_annotations</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                                        class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>                                        skip_class <span class="op">=</span> <span class="st">"unclassified"</span><span class="op">)</span> <span class="co"># Or class ID</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mat_count</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   class                           n</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Akashiwo_sanguinea              1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Alexandrium_pseudogonyaulax     7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Amphidnium_like                 2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Apedinella_radians              8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Centrales                       8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Cerataulina_pelagica           97</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="run-image-gallery">Run Image Gallery<a class="anchor" aria-label="anchor" href="#run-image-gallery"></a>
</h3>
<p>To visually inspect and correct annotations, run the image
gallery.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run Shiny app</span></span>
<span><span class="fu"><a href="../reference/ifcb_run_image_gallery.html">ifcb_run_image_gallery</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/image_gallery.png" alt="image_gallery">
Individual images can be selected and a list of selected images can be
downloaded as a ‘correction_file’. This file can be used to correct .mat
annotations below using the <code>ifcb_correct_annotation</code>
function.</p>
</div>
<div class="section level3">
<h3 id="correct--mat-files-after-checking-images-in-the-app">Correct .mat Files After Checking Images in the App<a class="anchor" aria-label="anchor" href="#correct--mat-files-after-checking-images-in-the-app"></a>
</h3>
<p>After reviewing images in the gallery, correct the .mat files using
the ‘correction file’ with selected images:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get class2use</span></span>
<span><span class="va">class_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_names.html">ifcb_get_mat_names</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span><span class="op">)</span></span>
<span><span class="va">class2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_variable.html">ifcb_get_mat_variable</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span>,</span>
<span>                                   variable_name <span class="op">=</span> <span class="va">class_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the class id of unclassified</span></span>
<span><span class="va">unclassified_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"unclassified"</span>,</span>
<span>                         <span class="va">class2use</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the python session if not already set up</span></span>
<span><span class="co"># ifcb_py_install(envname = ".virtualenvs/iRfcb") # If not already initialized</span></span>
<span></span>
<span><span class="co"># Correct the annotation with the output from the image gallery</span></span>
<span><span class="fu"><a href="../reference/ifcb_correct_annotation.html">ifcb_correct_annotation</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                        out_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                        correction_file <span class="op">=</span> <span class="st">"data/manual/correction/Alexandrium_pseudogonyaulax_selected_images.txt"</span>,</span>
<span>                        correct_classid <span class="op">=</span> <span class="va">unclassified_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="replace-specific-class-annotations">Replace Specific Class Annotations<a class="anchor" aria-label="anchor" href="#replace-specific-class-annotations"></a>
</h3>
<p>Replace all instances of a specific class with “unclassified” (class
id 1):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get class2use</span></span>
<span><span class="va">class_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_names.html">ifcb_get_mat_names</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span><span class="op">)</span></span>
<span><span class="va">class2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_variable.html">ifcb_get_mat_variable</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span>,</span>
<span>                                   variable_name <span class="op">=</span> <span class="va">class_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the class id of Alexandrium_pseudogonyaulax</span></span>
<span><span class="va">ap_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Alexandrium_pseudogonyaulax"</span>,</span>
<span>                     <span class="va">class2use</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the class id of unclassified</span></span>
<span><span class="va">unclassified_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"unclassified"</span>,</span>
<span>                         <span class="va">class2use</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the python session if not already set up</span></span>
<span><span class="co"># ifcb_py_install(envname = ".virtualenvs/iRfcb") # If not already initialized</span></span>
<span></span>
<span><span class="co"># Move all Alexandrium_pseudogonyaulax images to unclassified</span></span>
<span><span class="fu"><a href="../reference/ifcb_replace_mat_values.html">ifcb_replace_mat_values</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                        out_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                        target_id <span class="op">=</span> <span class="va">ap_id</span>,</span>
<span>                        new_id <span class="op">=</span> <span class="va">unclassified_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-annotated-images">Extract Annotated Images<a class="anchor" aria-label="anchor" href="#extract-annotated-images"></a>
</h3>
<p>Extract annotated images, skipping the “unclassified” (class id 1)
category:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract .png images</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_annotated_images.html">ifcb_extract_annotated_images</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                              class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>                              roi_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                              out_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>                              skip_class <span class="op">=</span> <span class="fl">1</span>, <span class="co"># or "unclassified"</span></span>
<span>                              verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="verify-correction">Verify Correction<a class="anchor" aria-label="anchor" href="#verify-correction"></a>
</h3>
<p>Verify that the corrections have been applied:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize new counts after correction</span></span>
<span><span class="va">png_per_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_png_data.html">ifcb_summarize_png_data</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>                                         hdr_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                                         sum_level <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">png_per_class</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   sample, ifcb_number [3]</span></span></span>
<span><span class="co">##   sample    ifcb_number class_name n_images roi_numbers gpsLatitude gpsLongitude</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> D2022052… IFCB134     Ciliates_…        1 5                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D2022052… IFCB134     Mesodiniu…        4 2, 6, 7, 8           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> D2022052… IFCB134     Strombidi…        1 3                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D2022052… IFCB134     Mesodiniu…        2 2, 3                 <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> D2022052… IFCB134     Ciliates_…        1 2                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> D2022052… IFCB134     Strombidi…        1 5                    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 6 more variables: timestamp &lt;dttm&gt;, date &lt;date&gt;, year &lt;dbl&gt;, month &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   day &lt;int&gt;, time &lt;chr&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="prepare-zip-packages-for-publication">Prepare Zip-Packages for Publication<a class="anchor" aria-label="anchor" href="#prepare-zip-packages-for-publication"></a>
</h2>
<div class="section level3">
<h3 id="png-directory-1">PNG Directory<a class="anchor" aria-label="anchor" href="#png-directory-1"></a>
</h3>
<p>Prepare the PNG directory for publication as a zip-archive, similar
to the files in the <a href="https://doi.org/10.17044/scilifelab.25883455" class="external-link">SMHI IFCB Plankton
image reference library</a>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create zip-archive</span></span>
<span><span class="fu"><a href="../reference/ifcb_zip_pngs.html">ifcb_zip_pngs</a></span><span class="op">(</span>png_folder <span class="op">=</span> <span class="st">"data/extracted_images"</span>,</span>
<span>              zip_filename <span class="op">=</span> <span class="st">"zip/smhi_ifcb_skagerrak_kattegat_annotated_images_corrected.zip"</span>,</span>
<span>              readme_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata/README-template.md"</span>, </span>
<span>                                        package <span class="op">=</span> <span class="st">"iRfcb"</span><span class="op">)</span>, <span class="co"># Template icluded in `iRfcb`</span></span>
<span>              email_address <span class="op">=</span> <span class="st">"tutorial@test.com"</span>,</span>
<span>              version <span class="op">=</span> <span class="st">"1.1"</span>,</span>
<span>              print_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Creating README file...</span></span></code></pre>
<pre><code><span><span class="co">## Creating MANIFEST.txt...</span></span></code></pre>
<pre><code><span><span class="co">## Creating zip archive...</span></span></code></pre>
<pre><code><span><span class="co">## Zip archive created successfully.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="matlab-directory">MATLAB Directory<a class="anchor" aria-label="anchor" href="#matlab-directory"></a>
</h3>
<p>Prepare the MATLAB directory for publication as a zip-archive,
similar to the files in the <a href="https://doi.org/10.17044/scilifelab.25883455" class="external-link">SMHI IFCB Plankton
image reference library</a>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create zip-archive</span></span>
<span><span class="fu"><a href="../reference/ifcb_zip_matlab.html">ifcb_zip_matlab</a></span><span class="op">(</span>manual_folder <span class="op">=</span> <span class="st">"data/manual"</span>,</span>
<span>                features_folder <span class="op">=</span> <span class="st">"data/features"</span>,</span>
<span>                class2use_file <span class="op">=</span> <span class="st">"data/config/class2use.mat"</span>,</span>
<span>                zip_filename <span class="op">=</span> <span class="st">"zip/smhi_ifcb_skagerrak_kattegat_matlab_files_corrected.zip"</span>,</span>
<span>                data_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                readme_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata/README-template.md"</span>, </span>
<span>                                          package <span class="op">=</span> <span class="st">"iRfcb"</span><span class="op">)</span>, <span class="co"># Template icluded in `iRfcb`</span></span>
<span>                matlab_readme_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata/MATLAB-template.md"</span>, </span>
<span>                                                 package <span class="op">=</span> <span class="st">"iRfcb"</span><span class="op">)</span>, <span class="co"># Template icluded in `iRfcb`</span></span>
<span>                email_address <span class="op">=</span> <span class="st">"tutorial@test.com"</span>,</span>
<span>                version <span class="op">=</span> <span class="st">"1.1"</span>,</span>
<span>                print_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Listing all files...</span></span></code></pre>
<pre><code><span><span class="co">## Copying manual files...</span></span></code></pre>
<pre><code><span><span class="co">## Copying feature files...</span></span></code></pre>
<pre><code><span><span class="co">## Copying data files...</span></span></code></pre>
<pre><code><span><span class="co">## Copying class2use file...</span></span></code></pre>
<pre><code><span><span class="co">## Creating README file...</span></span></code></pre>
<pre><code><span><span class="co">## Creating MANIFEST.txt...</span></span></code></pre>
<pre><code><span><span class="co">## Creating zip archive...</span></span></code></pre>
<pre><code><span><span class="co">## Zip archive created successfully.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="create-manifest-txt">Create MANIFEST.txt<a class="anchor" aria-label="anchor" href="#create-manifest-txt"></a>
</h3>
<p>Create a manifest file for the zip packages:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create MANIFEST.txt of the zip folder content</span></span>
<span><span class="fu"><a href="../reference/ifcb_create_manifest.html">ifcb_create_manifest</a></span><span class="op">(</span><span class="st">"zip/"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MANIFEST.txt has been created at zip//MANIFEST.txt</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="misc">MISC<a class="anchor" aria-label="anchor" href="#misc"></a>
</h2>
<div class="section level3">
<h3 id="extract--png-from-a-sample">Extract .png from a Sample<a class="anchor" aria-label="anchor" href="#extract--png-from-a-sample"></a>
</h3>
<p>Extract all images from a sample:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All ROIs in sample</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_pngs.html">ifcb_extract_pngs</a></span><span class="op">(</span><span class="st">"data/data/2023/D20230314/D20230314T001205_IFCB134.roi"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 1276 ROIs from D20230314T001205_IFCB134.roi to data/data/2023/D20230314/D20230314T001205_IFCB134</span></span></code></pre>
<p>Extract specific ROIs:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only ROI number 2 and 5</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_pngs.html">ifcb_extract_pngs</a></span><span class="op">(</span><span class="st">"data/data/2023/D20230314/D20230314T003836_IFCB134.roi"</span>,</span>
<span>                  ROInumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 2 ROIs from D20230314T003836_IFCB134.roi to data/data/2023/D20230314/D20230314T003836_IFCB134</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="extract-timestamps-from-filenames">Extract Timestamps from Filenames<a class="anchor" aria-label="anchor" href="#extract-timestamps-from-filenames"></a>
</h3>
<p>Extract timestamps from filenames:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example sample names</span></span>
<span><span class="va">filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D20230314T001205_IFCB134"</span>,</span>
<span>               <span class="st">"D20230615T123045_IFCB135"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert filenames to timestamps</span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_convert_filenames.html">ifcb_convert_filenames</a></span><span class="op">(</span><span class="va">filenames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">timestamps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     sample           timestamp       date year month day</span></span>
<span><span class="co">## 1 D20230314T001205_IFCB134 2023-03-14 00:12:05 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 2 D20230615T123045_IFCB135 2023-06-15 12:30:45 2023-06-15 2023     6  15</span></span>
<span><span class="co">##       time ifcb_number</span></span>
<span><span class="co">## 1 00:12:05     IFCB134</span></span>
<span><span class="co">## 2 12:30:45     IFCB135</span></span></code></pre>
<p>With ROI numbers:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example sample names</span></span>
<span><span class="va">filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D20230314T001205_IFCB134_00023.png"</span>,</span>
<span>               <span class="st">"D20230615T123045_IFCB135"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert filenames to timestamps</span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_convert_filenames.html">ifcb_convert_filenames</a></span><span class="op">(</span><span class="va">filenames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">timestamps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     sample           timestamp       date year month day</span></span>
<span><span class="co">## 1 D20230314T001205_IFCB134 2023-03-14 00:12:05 2023-03-14 2023     3  14</span></span>
<span><span class="co">## 2 D20230615T123045_IFCB135 2023-06-15 12:30:45 2023-06-15 2023     6  15</span></span>
<span><span class="co">##       time ifcb_number roi</span></span>
<span><span class="co">## 1 00:12:05     IFCB134  23</span></span>
<span><span class="co">## 2 12:30:45     IFCB135  NA</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="get-volume-analyzed-in-ml">Get Volume Analyzed in ml<a class="anchor" aria-label="anchor" href="#get-volume-analyzed-in-ml"></a>
</h3>
<p>Get the volume analyzed from header/adc files:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path to HDR file</span></span>
<span><span class="va">hdr_file</span> <span class="op">&lt;-</span> <span class="st">"data/data/2023/D20230314/D20230314T001205_IFCB134.hdr"</span></span>
<span></span>
<span><span class="co"># Calculate volume analyzed (in ml)</span></span>
<span><span class="va">volume_analyzed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_volume_analyzed.html">ifcb_volume_analyzed</a></span><span class="op">(</span><span class="va">hdr_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">volume_analyzed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4.568676</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="get-runtime">Get Runtime<a class="anchor" aria-label="anchor" href="#get-runtime"></a>
</h3>
<p>Get the runtime from a header file:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get runtime from HDR-file</span></span>
<span><span class="va">run_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_runtime.html">ifcb_get_runtime</a></span><span class="op">(</span><span class="va">hdr_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">run_time</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $runtime</span></span>
<span><span class="co">## [1] 1200.853</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inhibittime</span></span>
<span><span class="co">## [1] 104.3704</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="check-whether-a-class-name-is-a-diatom">Check whether a class name is a diatom<a class="anchor" aria-label="anchor" href="#check-whether-a-class-name-is-a-diatom"></a>
</h3>
<p>This function takes a list of taxa names, cleans them, retrieves
their corresponding classification records from the World Register of
Marine Species (WoRMS), and checks if they belong to the specified
diatom class. The function only uses the first name (genus name) of each
taxa for classification. This function can be useful for converting
biovolumes to carbon according to Menden-Deuer and Lessard 2000. See
<code>iRfcb:::vol2C_nondiatom</code> and
<code>iRfcb:::vol2C_lgdiatom</code> for carbon calculations (not
included in NAMESPACE).</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read class2use file</span></span>
<span><span class="va">class2use</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_mat_variable.html">ifcb_get_mat_variable</a></span><span class="op">(</span><span class="st">"data/config/class2use.mat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a dataframe with class name and result from `ifcb_is_diatom`</span></span>
<span><span class="va">class_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">class2use</span>,</span>
<span>                         is_diatom <span class="op">=</span> <span class="fu"><a href="../reference/ifcb_is_diatom.html">ifcb_is_diatom</a></span><span class="op">(</span><span class="va">class2use</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">class_list</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 class2use is_diatom</span></span>
<span><span class="co">## 1            unclassified     FALSE</span></span>
<span><span class="co">## 2           Dinobryon_spp     FALSE</span></span>
<span><span class="co">## 3          Helicostomella     FALSE</span></span>
<span><span class="co">## 4         Laboea_strobila     FALSE</span></span>
<span><span class="co">## 5       Mesodinium_rubrum     FALSE</span></span>
<span><span class="co">## 6 Parafavella_denticulata     FALSE</span></span></code></pre>
<p>The default class for diatoms is defined as Bacillariophyceae, but
may be adjusted using the <code>diatom_class</code> argument.</p>
</div>
<div class="section level3">
<h3 id="find-trophic-type-of-plankton-taxa">Find trophic type of plankton taxa<a class="anchor" aria-label="anchor" href="#find-trophic-type-of-plankton-taxa"></a>
</h3>
<p>This function takes a list of taxa names and matches them with the
<code>SMHI Trophic Type</code> list used in <a href="https://sharkweb.smhi.se/hamta-data/" class="external-link">SHARK</a>.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example taxa names</span></span>
<span><span class="va">taxa_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Acanthoceras zachariasii"</span>,</span>
<span>               <span class="st">"Nodularia spumigena"</span>,</span>
<span>               <span class="st">"Acanthoica quattrospina"</span>,</span>
<span>               <span class="st">"Noctiluca"</span>,</span>
<span>               <span class="st">"Gymnodiniales"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get trophic type for taxa</span></span>
<span><span class="va">trophic_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_trophic_type.html">ifcb_get_trophic_type</a></span><span class="op">(</span><span class="va">taxa_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trophic_type</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "AU" "AU" "MX" "HT" "NS"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="check-whether-the-positions-are-within-the-baltic-sea-or-elsewhere">Check whether the positions are within the Baltic Sea or
elsewhere<a class="anchor" aria-label="anchor" href="#check-whether-the-positions-are-within-the-baltic-sea-or-elsewhere"></a>
</h3>
<p>This check is useful if only you want to apply a classifier
specifically to phytoplankton from the Baltic Sea.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define example latitude and longitude vectors</span></span>
<span><span class="va">latitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55.337</span>, <span class="fl">54.729</span>, <span class="fl">56.311</span>, <span class="fl">57.975</span><span class="op">)</span></span>
<span><span class="va">longitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.674</span>, <span class="fl">14.643</span>, <span class="fl">12.237</span>, <span class="fl">10.637</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check if the points are in the Baltic Sea Basin</span></span>
<span><span class="va">points_in_the_baltic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_is_in_basin.html">ifcb_is_in_basin</a></span><span class="op">(</span><span class="va">latitudes</span>, <span class="va">longitudes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">points_in_the_baltic</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  TRUE  TRUE FALSE FALSE</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the points and the basin</span></span>
<span><span class="fu"><a href="../reference/ifcb_is_in_basin.html">ifcb_is_in_basin</a></span><span class="op">(</span><span class="va">latitudes</span>, <span class="va">longitudes</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>This function reads a land-buffered shapefile of the Baltic Sea Basin
(including Öresund) from the ‘iRfcb’ package by default, or a
user-supplied shapefile if provided.</p>
</div>
<div class="section level3">
<h3 id="find-missing-positions-from-rv-svea-ferrybox">Find missing positions from RV Svea Ferrybox<a class="anchor" aria-label="anchor" href="#find-missing-positions-from-rv-svea-ferrybox"></a>
</h3>
<p>This function is used by SMHI to collect and match stored ferrybox
positions when they are not available in the .hdr files.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read HDR data and extract GPS position (when available)</span></span>
<span><span class="va">gps_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_hdr_data.html">ifcb_read_hdr_data</a></span><span class="op">(</span><span class="st">"data/data/"</span>,</span>
<span>                               gps_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Found 91 .hdr files.</span></span>
<span><span class="co">## Processing completed.</span></span></code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define path where ferrybox data are located</span></span>
<span><span class="va">ferrybox_folder</span> <span class="op">&lt;-</span> <span class="st">"data/ferrybox_data"</span></span>
<span></span>
<span><span class="co"># Get GPS position from ferrybox data</span></span>
<span><span class="va">positions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_svea_position.html">ifcb_get_svea_position</a></span><span class="op">(</span><span class="va">gps_data</span><span class="op">$</span><span class="va">timestamp</span>, <span class="va">ferrybox_folder</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">positions</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             timestamp gpsLatitude gpsLongitude</span></span>
<span><span class="co">## 1 2022-05-22 00:04:39     55.0277      13.6142</span></span>
<span><span class="co">## 2 2022-05-22 00:30:51          NA           NA</span></span>
<span><span class="co">## 3 2022-05-22 00:57:03          NA           NA</span></span>
<span><span class="co">## 4 2022-05-22 01:49:28          NA           NA</span></span>
<span><span class="co">## 5 2022-05-22 06:37:41          NA           NA</span></span>
<span><span class="co">## 6 2022-05-22 07:30:05          NA           NA</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="get-the-column-names-needed-for-a-data-delivery-to-shark">Get the column names needed for a data delivery to SHARK<a class="anchor" aria-label="anchor" href="#get-the-column-names-needed-for-a-data-delivery-to-shark"></a>
</h3>
<p>This function is used by SMHI to map IFCB data into the <a href="https://sharkweb.smhi.se/hamta-data/" class="external-link">SHARK</a> standard data
delivery format.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load column names stored from `iRfcb`</span></span>
<span><span class="va">shark_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_get_shark_colnames.html">ifcb_get_shark_colnames</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print column names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">shark_colnames</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] MYEAR                     STATN                    </span></span>
<span><span class="co">##  [3] SAMPLING_PLATFORM         PROJ                     </span></span>
<span><span class="co">##  [5] ORDERER                   SHIPC                    </span></span>
<span><span class="co">##  [7] CRUISE_NO                 DATE_TIME                </span></span>
<span><span class="co">##  [9] SDATE                     TIMEZONE                 </span></span>
<span><span class="co">## [11] STIME                     LATIT                    </span></span>
<span><span class="co">## [13] LONGI                     POSYS                    </span></span>
<span><span class="co">## [15] WADEP                     MSTAT                    </span></span>
<span><span class="co">## [17] MPROG                     MNDEP                    </span></span>
<span><span class="co">## [19] MXDEP                     SLABO                    </span></span>
<span><span class="co">## [21] ACKR_SMP                  SMTYP                    </span></span>
<span><span class="co">## [23] PDMET                     SMVOL                    </span></span>
<span><span class="co">## [25] METFP                     IFCBNO                   </span></span>
<span><span class="co">## [27] SMPNO                     LATNM                    </span></span>
<span><span class="co">## [29] SFLAG                     TRPHY                    </span></span>
<span><span class="co">## [31] APHIA_ID                  COUNT                    </span></span>
<span><span class="co">## [33] ABUND                     BIOVOL                   </span></span>
<span><span class="co">## [35] C_CONC                    QFLAG                    </span></span>
<span><span class="co">## [37] COEFF                     CLASS_NAME               </span></span>
<span><span class="co">## [39] CLASS_PD                  CLASS_PR                 </span></span>
<span><span class="co">## [41] CLASS_PM                  METOA                    </span></span>
<span><span class="co">## [43] COUNTPROG                 ALABO                    </span></span>
<span><span class="co">## [45] ACKR_ANA                  ANADATE                  </span></span>
<span><span class="co">## [47] METDC                     TRAINING_SET             </span></span>
<span><span class="co">## [49] TRAINING_SET_ANNOTATED_BY CLASSIFIER_CREATED_BY    </span></span>
<span><span class="co">## [51] CLASSIFIER_USED           MANUAL_QC_DATE           </span></span>
<span><span class="co">## [53] PRE_FILTER_SIZE          </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="working-with-classified-results-from-matlab">Working with Classified Results from MATLAB<a class="anchor" aria-label="anchor" href="#working-with-classified-results-from-matlab"></a>
</h2>
<div class="section level3">
<h3 id="extract-classified-results-from-a-sample">Extract Classified Results from a Sample<a class="anchor" aria-label="anchor" href="#extract-classified-results-from-a-sample"></a>
</h3>
<div class="section level4">
<h4 id="note-these-steps-require--mat-and--csv-files-generated-by-the-matlab-package-ifcb-analysis-sosik-and-olson-2007">NOTE: These steps require .mat and .csv files generated by the
MATLAB package <a href="https://github.com/hsosik/ifcb-analysis" class="external-link">ifcb-analysis</a> (Sosik
and Olson 2007)<a class="anchor" aria-label="anchor" href="#note-these-steps-require--mat-and--csv-files-generated-by-the-matlab-package-ifcb-analysis-sosik-and-olson-2007"></a>
</h4>
<p>Extract classified results from a sample:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract all classified images from a sample</span></span>
<span><span class="fu"><a href="../reference/ifcb_extract_classified_images.html">ifcb_extract_classified_images</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="st">"D20230810T113059_IFCB134"</span>,</span>
<span>                               classified_folder <span class="op">=</span> <span class="st">"data/classified"</span>,</span>
<span>                               roi_folder <span class="op">=</span> <span class="st">"data/data"</span>,</span>
<span>                               out_folder <span class="op">=</span> <span class="st">"data/classified_images"</span>,</span>
<span>                               taxa <span class="op">=</span> <span class="st">"All"</span>, <span class="co"># or specify a particular taxa</span></span>
<span>                               threshold <span class="op">=</span> <span class="st">"opt"</span><span class="op">)</span> <span class="co"># or specify another threshold</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing 2747 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Heterocapsa_rotundata </span></span>
<span><span class="co">## Writing 519 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Cryptomonadales </span></span>
<span><span class="co">## Writing 464 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Dino_smaller_than_30unidentified </span></span>
<span><span class="co">## Writing 511 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/unclassified </span></span>
<span><span class="co">## Writing 6 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Ciliates </span></span>
<span><span class="co">## Writing 245 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Leptocylindrus_danicus_minimus </span></span>
<span><span class="co">## Writing 114 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Leptocylindrus_danicus </span></span>
<span><span class="co">## Writing 66 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Cylindrotheca_Nitzschia_longissima </span></span>
<span><span class="co">## Writing 23 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Chaetoceros_chain </span></span>
<span><span class="co">## Writing 6 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Dino_larger_than_30unidentified </span></span>
<span><span class="co">## Writing 23 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Prorocentrum_micans </span></span>
<span><span class="co">## Writing 51 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Scrippsiella_group </span></span>
<span><span class="co">## Writing 2 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Tripos_lineatus </span></span>
<span><span class="co">## Writing 1 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Cerataulina_pelagica </span></span>
<span><span class="co">## Writing 6 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Gymnodiniales_smaller_than_30 </span></span>
<span><span class="co">## Writing 3 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Chaetoceros_single_cell </span></span>
<span><span class="co">## Writing 5 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Skeletonema_marinoi </span></span>
<span><span class="co">## Writing 1 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Enisiculifera_carinata </span></span>
<span><span class="co">## Writing 2 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Thalassiosira_gravida </span></span>
<span><span class="co">## Writing 2 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Pseudo-nitzschia_spp </span></span>
<span><span class="co">## Writing 1 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Octactis_speculum </span></span>
<span><span class="co">## Writing 3 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Guinardia_delicatula </span></span>
<span><span class="co">## Writing 1 ROIs from D20230810T113059_IFCB134.roi to data/classified_images/Thalassiosira_nordenskioeldii</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="read-feature-data">Read feature data<a class="anchor" aria-label="anchor" href="#read-feature-data"></a>
</h3>
<p>Read all feature files (.csv) from a folder:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read feature files from a folder</span></span>
<span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_features.html">ifcb_read_features</a></span><span class="op">(</span><span class="st">"data/features/2023/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read only multiblob feature files</span></span>
<span><span class="va">multiblob_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_features.html">ifcb_read_features</a></span><span class="op">(</span><span class="st">"data/features/2023"</span>, multiblob <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-a-summary-file">Read a Summary File<a class="anchor" aria-label="anchor" href="#read-a-summary-file"></a>
</h3>
<p>Read a summary file:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read a MATLAB summary file generated by `countcells_allTBnew_user_training`</span></span>
<span><span class="va">summary_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_read_summary.html">ifcb_read_summary</a></span><span class="op">(</span><span class="st">"data/classified/2023/summary/summary_allTB_2023.mat"</span>,</span>
<span>                                  biovolume <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  threshold <span class="op">=</span> <span class="st">"opt"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summarize-counts-biovolumes-and-carbon-content-from-classified-ifcb-data">Summarize counts, biovolumes and carbon content from classified IFCB
data<a class="anchor" aria-label="anchor" href="#summarize-counts-biovolumes-and-carbon-content-from-classified-ifcb-data"></a>
</h3>
<p>This function calculates aggregated biovolumes and carbon content
from Imaging FlowCytobot (IFCB) samples based on feature and MATLAB
classification result files, without summarizing the data in MATLAB.
Biovolumes are converted to carbon according to Menden-Deuer and Lessard
2000 for individual regions of interest (ROI), where different
conversion factors are applied to diatoms and non-diatom protist. If
provided, it also incorporates sample volume data from HDR files to
compute biovolume and carbon content per liter of sample. See details in
the help pages for <code>ifcb_summarize_biovolumes</code> and
<code>ifcb_extract_biovolumes</code>.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize biovolume data using IFCB data from the specified folders</span></span>
<span><span class="va">biovolume_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ifcb_summarize_biovolumes.html">ifcb_summarize_biovolumes</a></span><span class="op">(</span>feature_folder <span class="op">=</span> <span class="st">"data/features/2023"</span>,</span>
<span>                                            class_folder <span class="op">=</span> <span class="st">"data/classified"</span>,</span>
<span>                                            hdr_folder <span class="op">=</span> <span class="st">"data/data/2023"</span>,</span>
<span>                                            micron_factor <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3.4</span>,</span>
<span>                                            diatom_class <span class="op">=</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span>                                            threshold <span class="op">=</span> <span class="st">"opt"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO: The following classes are considered NOT diatoms for carbon calculations:</span></span>
<span><span class="co">## Ciliates</span></span>
<span><span class="co">## Cryptomonadales</span></span>
<span><span class="co">## Dino_larger_than_30unidentified</span></span>
<span><span class="co">## Dino_smaller_than_30unidentified</span></span>
<span><span class="co">## Enisiculifera_carinata</span></span>
<span><span class="co">## Gymnodiniales_smaller_than_30</span></span>
<span><span class="co">## Heterocapsa_rotundata</span></span>
<span><span class="co">## Octactis_speculum</span></span>
<span><span class="co">## Prorocentrum_micans</span></span>
<span><span class="co">## Scrippsiella_group</span></span>
<span><span class="co">## Tripos_lineatus</span></span>
<span><span class="co">## unclassified</span></span></code></pre>
<p>This concludes the tutorial for the <code>iRfcb</code> package. For
more detailed information, refer to the package documentation. Happy
analyzing!</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Hayashi, K., Walton, J., Lie, A., Smith, J. and Kudela M. Using
particle size distribution (PSD) to automate imaging flow cytobot (IFCB)
data quality in coastal California, USA. In prep.</li>
<li>Menden-Deuer Susanne, Lessard Evelyn J., (2000), Carbon to volume
relationships for dinoflagellates, diatoms, and other protist plankton,
Limnology and Oceanography, 3, doi: 10.4319/lo.2000.45.3.0569.</li>
<li>Sosik, H. M. and Olson, R. J. (2007) Automated taxonomic
classification of phytoplankton sampled with imaging-in-flow cytometry.
Limnol. Oceanogr: Methods 5, 204–216.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Anders Torstensson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
